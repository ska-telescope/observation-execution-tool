<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1766px" preserveAspectRatio="none" style="width:1695px;height:1766px;background:#FFFFFF;" version="1.1" viewBox="0 0 1695 1766" width="1695px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1755.377" style="stroke:#000000;stroke-width:1.5;" width="1680.5" x="9" y="5"/><path d="M189,5 L189,14.4883 L179,24.4883 L9,24.4883 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="170" x="12" y="19.5352">Scripting API over REST</text><rect height="1004.2637" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1667.5" x="15" y="683.1367"/><rect height="165.1738" style="stroke:#000000;stroke-width:1.5;fill:none;" width="704" x="340" y="1151.9238"/><rect height="83.2422" style="stroke:#000000;stroke-width:1.5;fill:none;" width="522" x="350" y="1226.8555"/><rect height="83.2422" style="stroke:#000000;stroke-width:1.5;fill:none;" width="912.5" x="25" y="1383.7188"/><rect height="199.4395" style="stroke:#000000;stroke-width:1.5;fill:none;" width="913.5" x="25" y="1480.9609"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="83" x2="83" y1="79.4648" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="357.5" x2="357.5" y1="79.4648" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="524.5" x2="524.5" y1="79.4648" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="714" x2="714" y1="336.8691" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="823" x2="823" y1="398.8232" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="953" x2="953" y1="79.4648" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1119" x2="1119" y1="79.4648" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1384.5" x2="1384.5" y1="79.4648" y2="1704.4004"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1587.5" x2="1587.5" y1="79.4648" y2="1704.4004"/><rect fill="#90EE90" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="35" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="69" y="52.0234">CLI :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="42" y="68.5117">RestClientUI</text><rect fill="#90EE90" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="35" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="69" y="1723.9355">CLI :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="42" y="1740.4238">RestClientUI</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="298.5" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="305.5" y="52.0234">REST backend :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="315.5" y="68.5117">FlaskWorker</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118" x="298.5" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104" x="305.5" y="1723.9355">REST backend :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="315.5" y="1740.4238">FlaskWorker</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="453.5" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="460.5" y="52.0234">call_and_respond :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="496" y="68.5117">function</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="453.5" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="460.5" y="1723.9355">call_and_respond :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="496" y="1740.4238">function</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="682" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="689" y="1723.9355">queue :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="692" y="1740.4238">Queue</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77" x="785" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="792" y="1723.9355">callback :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="795" y="1740.4238">function</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="872" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="879" y="52.0234">FlaskWorker pubsub :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="919" y="68.5117">pypubsub</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="162" x="872" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="879" y="1723.9355">FlaskWorker pubsub :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="919" y="1740.4238">pypubsub</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="1044" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1051" y="52.0234">SESWorker pubsub :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="1085.5" y="68.5117">pypubsub</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="151" x="1044" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1051" y="1723.9355">SESWorker pubsub :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="1085.5" y="1740.4238">pypubsub</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218" x="1275.5" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1344" y="52.0234">SESWorker :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204" x="1282.5" y="68.5117">ScriptExecutionServiceWorker</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218" x="1275.5" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="1344" y="1723.9355">SESWorker :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204" x="1282.5" y="1740.4238">ScriptExecutionServiceWorker</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169" x="1503.5" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="1515.5" y="52.0234">Script Execution API :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="1510.5" y="68.5117">ScriptExecutionService</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169" x="1503.5" y="1703.4004"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="1515.5" y="1723.9355">Script Execution API :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="1510.5" y="1740.4238">ScriptExecutionService</text><polygon fill="#181818" points="345.5,140.3965,355.5,144.3965,345.5,148.3965,349.5,144.3965" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="83.5" x2="351.5" y1="144.3965" y2="144.3965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="90.5" y="139.6543">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="103.5" y="139.6543">HTTP POST</text><path d="M362,94.4648 L362,180.4648 L652,180.4648 L652,104.4648 L642,94.4648 L362,94.4648 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M642,94.4648 L642,104.4648 L652,104.4648 L642,94.4648 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="368" y="112.0332">The User executes an OET CLI command at</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="368" y="127.3438">the terminal. The OET CLI uses HTTP POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="368" y="142.6543">to sends a JSON object encapsulating the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="368" y="157.9648">request (script location, script arguments,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="368" y="173.2754">etc.) to the REST backend.</text><polygon fill="#181818" points="512.5,244.6045,522.5,248.6045,512.5,252.6045,516.5,248.6045" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="357.5" x2="518.5" y1="248.6045" y2="248.6045"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="364.5" y="243.8623">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="377.5" y="243.8623">call_and_respond(...)</text><path d="M529,191.0176 L529,292.0176 L879,292.0176 L879,201.0176 L869,191.0176 L529,191.0176 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M869,191.0176 L869,201.0176 L879,201.0176 L869,191.0176 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="535" y="208.2622">FlaskWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="627" y="208.5859">creates a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="687" y="208.2622">PrepareProcessCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="535" y="223.8965">encapsulating the request details and invokes the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="535" y="239.207"> </text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="539" y="238.8833">call_and_respond</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="671" y="239.207">helper function to announce</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="535" y="254.5176">the event on the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="172" x="641" y="254.5176">Create Procedure requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="817" y="254.5176">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="535" y="269.8281">topic and to expect a response on the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="62" x="777" y="269.8281">Procedure</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="46" x="535" y="285.1387">created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="585" y="285.1387">response topic.</text><polygon fill="#181818" points="670,315.1914,680,319.1914,670,323.1914,674,319.1914" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="524.5" x2="676" y1="319.1914" y2="319.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="531.5" y="314.4492">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="544.5" y="314.4492">«create»</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="65" x="682" y="297.8809"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="689" y="318.416">queue :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="692" y="334.9043">Queue</text><path d="M751.5,306.5586 L751.5,346.5586 L1131.5,346.5586 L1131.5,316.5586 L1121.5,306.5586 L751.5,306.5586 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1121.5,306.5586 L1121.5,316.5586 L1131.5,316.5586 L1121.5,306.5586 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="757.5" y="323.8032">call_and_respond</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="889.5" y="324.127">creates a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="949.5" y="323.8032">Queue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="993.5" y="324.127">that will receive the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="757.5" y="339.4375">response event emitted in response to this request.</text><polygon fill="#181818" points="773,373.168,783,377.168,773,381.168,777,377.168" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="524.5" x2="779" y1="377.168" y2="377.168"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="531.5" y="372.4258">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="544.5" y="372.4258">«create»</text><rect fill="#ADD8E6" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77" x="785" y="359.835"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="792" y="380.3701">callback :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="57" x="795" y="396.8584">function</text><path d="M866.5,360.8574 L866.5,415.8574 L1238.5,415.8574 L1238.5,370.8574 L1228.5,360.8574 L866.5,360.8574 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1228.5,360.8574 L1228.5,370.8574 L1238.5,370.8574 L1228.5,360.8574 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="351" x="872.5" y="378.4258">A callback function is created whose sole responsibility</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="872.5" y="393.7363">is to put events onto a queue if the event payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="872.5" y="409.0469">includes a unique correlation ID.</text><polygon fill="#181818" points="941,457.4102,951,461.4102,941,465.4102,945,461.4102" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="524.5" x2="947" y1="461.4102" y2="461.4102"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="531.5" y="456.668">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="544.5" y="456.668">subscribe(callback, topic=</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="107" x="711.5" y="456.668">«response topic»</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="818.5" y="456.668">)</text><path d="M958,426.7891 L958,481.7891 L1345,481.7891 L1345,436.7891 L1335,426.7891 L958,426.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1335,426.7891 L1335,436.7891 L1345,436.7891 L1335,426.7891 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="964" y="444.3574">The callback function is subscribed to the response topic.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343" x="964" y="459.668">Thereafter, pypubsub will invoke the callback function</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="363" x="964" y="474.9785">whenever for any events published on the response topic.</text><polygon fill="#181818" points="941,584.584,951,588.584,941,592.584,945,588.584" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="524.5" x2="947" y1="588.584" y2="588.584"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="531.5" y="583.8418">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="544.5" y="583.8418">sendMessage(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="97" x="632.5" y="583.8418">«request topic»</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="729.5" y="583.8418">, ...)</text><path d="M958,492.7207 L958,670.7207 L1354,670.7207 L1354,502.7207 L1344,492.7207 L958,492.7207 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1344,492.7207 L1344,502.7207 L1354,502.7207 L1344,492.7207 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="964" y="510.2891">An event is published announcing a user request was</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343" x="964" y="525.5996">received, the type of requested denoted by the request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="964" y="540.9102">topic. The event payload includes all positional and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="964" y="556.2207">keyword arguments passed to call_and_respond and varies</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="964" y="571.5313">depending on context. For instance, a 'prepare process'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="964" y="586.8418">request would include details of the script to run and script</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="964" y="602.1523">initialisation arguments; a 'start process' request would</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="964" y="617.4629">contain details of the process ID to start and the method to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="964" y="632.7734">call, etc. The helper function inserts a unique correlation ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="362" x="964" y="648.084">to the event payload, the same correlation ID given to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="964" y="663.3945">callback function for filtering events.</text><path d="M15,683.1367 L83,683.1367 L83,690.4473 L73,700.4473 L15,700.4473 L15,683.1367 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="1004.2637" style="stroke:#000000;stroke-width:1.5;" width="1667.5" x="15" y="683.1367"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23" x="30" y="696.7051">par</text><rect height="39.4434" style="stroke:#000000;stroke-width:1.5;fill:none;" width="329" x="869" y="700.4473"/><path d="M869,700.4473 L933,700.4473 L933,707.4473 L923,717.4473 L869,717.4473 L869,700.4473 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="882" y="715.0156">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="136" x="965.5" y="733.0488">inter-process pubsub</text><polygon fill="#181818" points="1372.5,803.4775,1382.5,807.4775,1372.5,811.4775,1376.5,807.4775" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1119.5" x2="1378.5" y1="807.4775" y2="807.4775"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1126.5" y="802.7354">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="1139.5" y="802.7354">call(...)</text><path d="M723,749.8906 L723,850.8906 L1114,850.8906 L1114,759.8906 L1104,749.8906 L723,749.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1104,749.8906 L1104,759.8906 L1114,759.8906 L1104,749.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="729" y="767.459">SESWorker has its various methods subscribed to the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="729" y="782.7695">appropriate request topics. For example, the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="1016" y="782.4458">prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="729" y="798.0801">method is subscribed to the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="149" x="910" y="798.0801">Prepare Process request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="729" y="813.3906">topic; the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="793" y="813.0669">start</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="837" y="813.3906">method is subscribed to the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="29" x="1018" y="813.3906">start</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="100" x="729" y="828.7012">process request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261" x="833" y="828.7012">topic, and so on. The appropriate method</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="729" y="844.0117">for this event request topic is called with the event details.</text><polygon fill="#181818" points="1576,907.6855,1586,911.6855,1576,915.6855,1580,911.6855" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1384.5" x2="1582" y1="911.6855" y2="911.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1391.5" y="906.9434">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1404.5" y="906.9434"> </text><path d="M891,861.7539 L891,947.7539 L1379,947.7539 L1379,871.7539 L1369,861.7539 L891,861.7539 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1369,861.7539 L1369,871.7539 L1379,871.7539 L1369,861.7539 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="897" y="879.3223">SESWorker method extracts details of the request from the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="287" x="897" y="894.6328">event and calls the appropriate method of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="1188" y="894.3091">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="897" y="909.9434">with the extracted arguments. Ths</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="1117" y="909.6196">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="1297" y="909.9434">will</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="426" x="897" y="925.2539">perform the appropriate action (load a script, start script execution,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="897" y="940.5645">abort a script, etc.).</text><polygon fill="#181818" points="1395.5,973.6172,1385.5,977.6172,1395.5,981.6172,1391.5,977.6172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1389.5" x2="1587" y1="977.6172" y2="977.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1401.5" y="972.875">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="1414.5" y="972.875">result</text><path d="M1038,958.3066 L1038,983.3066 L1379,983.3066 L1379,968.3066 L1369,958.3066 L1038,958.3066 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1369,958.3066 L1369,968.3066 L1379,968.3066 L1369,958.3066 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="1044" y="975.875">The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="1071" y="975.5513">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="1251" y="975.875">returns the result.</text><polygon fill="#181818" points="1130.5,1047.2041,1120.5,1051.2041,1130.5,1055.2041,1126.5,1051.2041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1124.5" x2="1383.5" y1="1051.2041" y2="1051.2041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1136.5" y="1046.4619">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1158.5" y="1046.4619">sendMessage(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="107" x="1246.5" y="1046.4619">«response topic»</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24" x="1353.5" y="1046.4619">, ...)</text><path d="M725,993.6172 L725,1094.6172 L1114,1094.6172 L1114,1003.6172 L1104,993.6172 L725,993.6172 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1104,993.6172 L1104,1003.6172 L1114,1003.6172 L1104,993.6172 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="731" y="1011.1855">SESWorker publishes an event on the response topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="731" y="1026.4961">The event payload will either be a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="945" y="1026.1724">ProcedureSummary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="731" y="1041.8066">if the call was successful or a stacktrace representation</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="731" y="1057.1172">if the call failed. The response event payload also includes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="731" y="1072.4277">the correlation ID included in the request event payload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="731" y="1087.7383">which triggered this action.</text><rect height="39.4434" style="stroke:#000000;stroke-width:1.5;fill:none;" width="329" x="869" y="1100.4805"/><path d="M869,1100.4805 L933,1100.4805 L933,1107.4805 L923,1117.4805 L869,1117.4805 L869,1100.4805 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="882" y="1115.0488">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="136" x="965.5" y="1133.082">inter-process pubsub</text><path d="M340,1151.9238 L414,1151.9238 L414,1159.2344 L404,1169.2344 L340,1169.2344 L340,1151.9238 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="165.1738" style="stroke:#000000;stroke-width:1.5;" width="704" x="340" y="1151.9238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="355" y="1165.4922">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="230" x="429" y="1164.5586">[each event published on response topic]</text><polygon fill="#181818" points="834.5,1197.2002,824.5,1201.2002,834.5,1205.2002,830.5,1201.2002" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="828.5" x2="952" y1="1201.2002" y2="1201.2002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="840.5" y="1196.458">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="862.5" y="1196.458">call(...)</text><path d="M478,1174.2344 L478,1214.2344 L818,1214.2344 L818,1184.2344 L808,1174.2344 L478,1174.2344 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M808,1174.2344 L808,1184.2344 L818,1184.2344 L808,1174.2344 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="484" y="1191.8027">As a subscriber to the response topic, the callback</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="484" y="1207.1133">function is called with the event.</text><path d="M350,1226.8555 L417,1226.8555 L417,1234.166 L407,1244.166 L350,1244.166 L350,1226.8555 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.2422" style="stroke:#000000;stroke-width:1.5;" width="522" x="350" y="1226.8555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="365" y="1240.4238">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="187" x="432" y="1239.4902">[response ID matches request ID]</text><polygon fill="#181818" points="725.5,1279.7871,715.5,1283.7871,725.5,1287.7871,721.5,1283.7871" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="719.5" x2="822.5" y1="1283.7871" y2="1283.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="731.5" y="1279.0449">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="753.5" y="1279.0449">put(event)</text><path d="M360,1249.166 L360,1304.166 L709,1304.166 L709,1259.166 L699,1249.166 L360,1249.166 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M699,1249.166 L699,1259.166 L709,1259.166 L699,1249.166 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="366" y="1266.7344">If the correlation ID in the response event matches</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="366" y="1282.0449">the correlation ID in the request, the response event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="366" y="1297.3555">is added to the queue.</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="15" x2="1682.5" y1="1325.0977" y2="1325.0977"/><polygon fill="#181818" points="702.5,1354.0635,712.5,1358.0635,702.5,1362.0635,706.5,1358.0635" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="524.5" x2="708.5" y1="1358.0635" y2="1358.0635"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="531.5" y="1353.3213">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="553.5" y="1353.3213">get(timeout=TIMEOUT)</text><path d="M146,1331.0977 L146,1371.0977 L519,1371.0977 L519,1341.0977 L509,1331.0977 L146,1331.0977 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M509,1331.0977 L509,1341.0977 L519,1341.0977 L509,1331.0977 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="152" y="1348.666">Meanwhile.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="226" y="1348.3423">call_and_respond</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="358" y="1348.666">waits at most TIMEOUT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="152" y="1363.9766">seconds for the response event to appear on the queue.</text><path d="M25,1383.7188 L92,1383.7188 L92,1391.0293 L82,1401.0293 L25,1401.0293 L25,1383.7188 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="83.2422" style="stroke:#000000;stroke-width:1.5;" width="912.5" x="25" y="1383.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="40" y="1397.2871">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="213" x="107" y="1396.3535">[no response received within timeout]</text><polygon fill="#181818" points="94.5,1436.6504,84.5,1440.6504,94.5,1444.6504,90.5,1440.6504" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88.5" x2="523.5" y1="1440.6504" y2="1440.6504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="100.5" y="1435.9082">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="122.5" y="1435.9082">HTTP error + JSON error object</text><path d="M529,1406.0293 L529,1461.0293 L922,1461.0293 L922,1416.0293 L912,1406.0293 L529,1406.0293 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M912,1406.0293 L912,1416.0293 L922,1416.0293 L912,1406.0293 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="372" x="535" y="1423.5977">If a result is not received within the timeout period, a HTTP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352" x="535" y="1438.9082">error response is returned to the client including a JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="535" y="1454.2188">object containing details of the timeout error.</text><path d="M25,1480.9609 L87,1480.9609 L87,1488.2715 L77,1498.2715 L25,1498.2715 L25,1480.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="199.4395" style="stroke:#000000;stroke-width:1.5;" width="913.5" x="25" y="1480.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="40" y="1494.5293">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="159" x="102" y="1493.5957">[response indicates success]</text><polygon fill="#181818" points="368.5,1526.2373,358.5,1530.2373,368.5,1534.2373,364.5,1530.2373" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="362.5" x2="523.5" y1="1530.2373" y2="1530.2373"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="374.5" y="1525.4951">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="396.5" y="1525.4951">event payload</text><path d="M529,1503.2715 L529,1543.2715 L909,1543.2715 L909,1513.2715 L899,1503.2715 L529,1503.2715 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M899,1503.2715 L899,1513.2715 L909,1513.2715 L899,1503.2715 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="535" y="1520.8398">If the response event indicates success, the event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="535" y="1536.1504">payload is extracted and returned to the calling function.</text><polygon fill="#181818" points="94.5,1576.8584,84.5,1580.8584,94.5,1584.8584,90.5,1580.8584" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88.5" x2="356.5" y1="1580.8584" y2="1580.8584"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="100.5" y="1576.1162">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="122.5" y="1576.1162">HTTP OK + ProcedureSummary JSON</text><path d="M362,1553.8926 L362,1593.8926 L738,1593.8926 L738,1563.8926 L728,1553.8926 L362,1553.8926 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M728,1553.8926 L728,1563.8926 L738,1563.8926 L728,1553.8926 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="368" y="1571.4609">A JSON representation of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="552" y="1571.1372">ProcedureSummary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="684" y="1571.4609">object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="368" y="1586.7715">in the response is created and returned to the user.</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="25" x2="938.5" y1="1600.5137" y2="1600.5137"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="144" x="30" y="1611.1484">[response indicates error]</text><polygon fill="#181818" points="94.5,1650.0898,84.5,1654.0898,94.5,1658.0898,90.5,1654.0898" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="88.5" x2="523.5" y1="1654.0898" y2="1654.0898"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="100.5" y="1649.3477">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="122.5" y="1649.3477">HTTP error + JSON error object</text><path d="M529,1619.4688 L529,1674.4688 L923,1674.4688 L923,1629.4688 L913,1619.4688 L529,1619.4688 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M913,1619.4688 L913,1629.4688 L923,1629.4688 L913,1619.4688 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="372" x="535" y="1637.0371">If a result is not received within the timeout period, a HTTP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="373" x="535" y="1652.3477">error response is returned to the UI including a JSON object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367" x="535" y="1667.6582">containing details of the exception described in the event.</text><!--MD5=[bcc3a3b69d6daf0c71b4372966f8a684]
@startuml
'https://plantuml.com/sequence-diagram


mainframe **Scripting API over REST**

autonumber

participant cli as "CLI :\nRestClientUI" #lightgreen
participant FlaskWorker as "REST backend :\nFlaskWorker" #lightblue
participant call_and_respond as "call_and_respond :\nfunction" #lightblue
participant queue as "queue :\nQueue" #lightblue
participant Callback as "callback :\nfunction" #lightblue
participant fw_pubsub as "FlaskWorker pubsub :\npypubsub" #lightblue
participant ses_pubsub as "SESWorker pubsub :\npypubsub"
participant ScriptExecutionServiceWorker as "SESWorker :\nScriptExecutionServiceWorker"
participant ScriptExecutionService as "Script Execution API :\nScriptExecutionService"

cli -> FlaskWorker: HTTP POST
note right
The User executes an OET CLI command at
the terminal. The OET CLI uses HTTP POST
to sends a JSON object encapsulating the
request (script location, script arguments,
etc.) to the REST backend.
end note

FlaskWorker -> call_and_respond: call_and_respond(...)
note right
""FlaskWorker"" creates a ""PrepareProcessCommand""
encapsulating the request details and invokes the
 ""call_and_respond"" helper function to announce
the event on the //Create Procedure requested// request
topic and to expect a response on the //Procedure//
//created// response topic.
end note

create queue
call_and_respond -> queue: «create»
note right
""call_and_respond"" creates a ""Queue"" that will receive the
response event emitted in response to this request.
end note

create Callback
call_and_respond -> Callback: «create»
note right
A callback function is created whose sole responsibility
is to put events onto a queue if the event payload
includes a unique correlation ID.
end note

call_and_respond -> fw_pubsub: subscribe(callback, topic=//«response topic»//)
note right
The callback function is subscribed to the response topic.
Thereafter, pypubsub will invoke the callback function
whenever for any events published on the response topic.
end note

call_and_respond -> fw_pubsub: sendMessage(//«request topic»//, ...)
note right
An event is published announcing a user request was
received, the type of requested denoted by the request
topic. The event payload includes all positional and
keyword arguments passed to call_and_respond and varies
depending on context. For instance, a 'prepare process'
request would include details of the script to run and script
initialisation arguments; a 'start process' request would
contain details of the process ID to start and the method to
call, etc. The helper function inserts a unique correlation ID
to the event payload, the same correlation ID given to the
callback function for filtering events.
end note

par

ref over fw_pubsub, ses_pubsub
**inter-process pubsub**
end

ses_pubsub -> ScriptExecutionServiceWorker: call(...)
note left
SESWorker has its various methods subscribed to the
appropriate request topics. For example, the  ""prepare""
method is subscribed to the //Prepare Process request//
topic; the ""start"" method is subscribed to the //start//
//process request// topic, and so on. The appropriate method
for this event request topic is called with the event details.
end note

ScriptExecutionServiceWorker -> ScriptExecutionService:
note left
SESWorker method extracts details of the request from the
event and calls the appropriate method of the ""ScriptExecutionService""
with the extracted arguments. Ths ""ScriptExecutionService"" will
perform the appropriate action (load a script, start script execution,
abort a script, etc.).
end note

ScriptExecutionService -> ScriptExecutionServiceWorker: result
note left
The ""ScriptExecutionService"" returns the result.
end note

ScriptExecutionServiceWorker -> ses_pubsub: sendMessage(//«response topic»//, ...)
note left
SESWorker publishes an event on the response topic
The event payload will either be a ""ProcedureSummary""
if the call was successful or a stacktrace representation
if the call failed. The response event payload also includes
the correlation ID included in the request event payload
which triggered this action.
end note

ref over fw_pubsub, ses_pubsub
**inter-process pubsub**
end


loop each event published on response topic
fw_pubsub -> Callback: call(...)
note left
As a subscriber to the response topic, the callback
function is called with the event.
end note

opt response ID matches request ID
Callback -> queue: put(event)
note left
If the correlation ID in the response event matches
the correlation ID in the request, the response event
is added to the queue.
end note
end
end

else
call_and_respond -> queue: get(timeout=TIMEOUT)
note left
Meanwhile. ""call_and_respond"" waits at most TIMEOUT
seconds for the response event to appear on the queue.
end note

opt no response received within timeout
cli <- - call_and_respond: HTTP error + JSON error object
note right
If a result is not received within the timeout period, a HTTP
error response is returned to the client including a JSON
object containing details of the timeout error.
end note
end opt

alt response indicates success
FlaskWorker <- - call_and_respond: event payload
note right
If the response event indicates success, the event
payload is extracted and returned to the calling function.
end note

cli <- - FlaskWorker: HTTP OK + ProcedureSummary JSON
note right
A JSON representation of the ""ProcedureSummary"" object
in the response is created and returned to the user.
end note

else response indicates error
cli <- - call_and_respond: HTTP error + JSON error object
note right
If a result is not received within the timeout period, a HTTP
error response is returned to the UI including a JSON object
containing details of the exception described in the event.
end note
end alt

end

@enduml

@startuml


mainframe **Scripting API over REST**

autonumber

participant cli as "CLI :\nRestClientUI" #lightgreen
participant FlaskWorker as "REST backend :\nFlaskWorker" #lightblue
participant call_and_respond as "call_and_respond :\nfunction" #lightblue
participant queue as "queue :\nQueue" #lightblue
participant Callback as "callback :\nfunction" #lightblue
participant fw_pubsub as "FlaskWorker pubsub :\npypubsub" #lightblue
participant ses_pubsub as "SESWorker pubsub :\npypubsub"
participant ScriptExecutionServiceWorker as "SESWorker :\nScriptExecutionServiceWorker"
participant ScriptExecutionService as "Script Execution API :\nScriptExecutionService"

cli -> FlaskWorker: HTTP POST
note right
The User executes an OET CLI command at
the terminal. The OET CLI uses HTTP POST
to sends a JSON object encapsulating the
request (script location, script arguments,
etc.) to the REST backend.
end note

FlaskWorker -> call_and_respond: call_and_respond(...)
note right
""FlaskWorker"" creates a ""PrepareProcessCommand""
encapsulating the request details and invokes the
 ""call_and_respond"" helper function to announce
the event on the //Create Procedure requested// request
topic and to expect a response on the //Procedure//
//created// response topic.
end note

create queue
call_and_respond -> queue: «create»
note right
""call_and_respond"" creates a ""Queue"" that will receive the
response event emitted in response to this request.
end note

create Callback
call_and_respond -> Callback: «create»
note right
A callback function is created whose sole responsibility
is to put events onto a queue if the event payload
includes a unique correlation ID.
end note

call_and_respond -> fw_pubsub: subscribe(callback, topic=//«response topic»//)
note right
The callback function is subscribed to the response topic.
Thereafter, pypubsub will invoke the callback function
whenever for any events published on the response topic.
end note

call_and_respond -> fw_pubsub: sendMessage(//«request topic»//, ...)
note right
An event is published announcing a user request was
received, the type of requested denoted by the request
topic. The event payload includes all positional and
keyword arguments passed to call_and_respond and varies
depending on context. For instance, a 'prepare process'
request would include details of the script to run and script
initialisation arguments; a 'start process' request would
contain details of the process ID to start and the method to
call, etc. The helper function inserts a unique correlation ID
to the event payload, the same correlation ID given to the
callback function for filtering events.
end note

par

ref over fw_pubsub, ses_pubsub
**inter-process pubsub**
end

ses_pubsub -> ScriptExecutionServiceWorker: call(...)
note left
SESWorker has its various methods subscribed to the
appropriate request topics. For example, the  ""prepare""
method is subscribed to the //Prepare Process request//
topic; the ""start"" method is subscribed to the //start//
//process request// topic, and so on. The appropriate method
for this event request topic is called with the event details.
end note

ScriptExecutionServiceWorker -> ScriptExecutionService:
note left
SESWorker method extracts details of the request from the
event and calls the appropriate method of the ""ScriptExecutionService""
with the extracted arguments. Ths ""ScriptExecutionService"" will
perform the appropriate action (load a script, start script execution,
abort a script, etc.).
end note

ScriptExecutionService -> ScriptExecutionServiceWorker: result
note left
The ""ScriptExecutionService"" returns the result.
end note

ScriptExecutionServiceWorker -> ses_pubsub: sendMessage(//«response topic»//, ...)
note left
SESWorker publishes an event on the response topic
The event payload will either be a ""ProcedureSummary""
if the call was successful or a stacktrace representation
if the call failed. The response event payload also includes
the correlation ID included in the request event payload
which triggered this action.
end note

ref over fw_pubsub, ses_pubsub
**inter-process pubsub**
end


loop each event published on response topic
fw_pubsub -> Callback: call(...)
note left
As a subscriber to the response topic, the callback
function is called with the event.
end note

opt response ID matches request ID
Callback -> queue: put(event)
note left
If the correlation ID in the response event matches
the correlation ID in the request, the response event
is added to the queue.
end note
end
end

else
call_and_respond -> queue: get(timeout=TIMEOUT)
note left
Meanwhile. ""call_and_respond"" waits at most TIMEOUT
seconds for the response event to appear on the queue.
end note

opt no response received within timeout
cli <- - call_and_respond: HTTP error + JSON error object
note right
If a result is not received within the timeout period, a HTTP
error response is returned to the client including a JSON
object containing details of the timeout error.
end note
end opt

alt response indicates success
FlaskWorker <- - call_and_respond: event payload
note right
If the response event indicates success, the event
payload is extracted and returned to the calling function.
end note

cli <- - FlaskWorker: HTTP OK + ProcedureSummary JSON
note right
A JSON representation of the ""ProcedureSummary"" object
in the response is created and returned to the user.
end note

else response indicates error
cli <- - call_and_respond: HTTP error + JSON error object
note right
If a result is not received within the timeout period, a HTTP
error response is returned to the UI including a JSON object
containing details of the exception described in the event.
end note
end alt

end

@enduml

PlantUML version 1.2022.5(Sat Apr 30 11:55:52 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>