<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1885px" preserveAspectRatio="none" style="width:1472px;height:1885px;background:#FFFFFF;" version="1.1" viewBox="0 0 1472 1885" width="1472px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1874.8164" style="stroke:#000000;stroke-width:1.5;" width="1466" x="0" y="5"/><path d="M255,5 L255,14.4883 L245,24.4883 L0,24.4883 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245" x="3" y="19.5352">seq: ScriptExecutionService.prepare</text><rect height="1710.375" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1454" x="5" y="96.4648"/><rect height="291.6582" style="stroke:#000000;stroke-width:1.5;fill:none;" width="757" x="407.5" y="471.498"/><rect height="344.2793" style="stroke:#000000;stroke-width:1.5;fill:none;" width="1444" x="5" y="1245.7656"/><rect height="193.7949" style="stroke:#000000;stroke-width:1.5;fill:none;" width="932.5" x="125" y="1606.0449"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="322.5" x2="322.5" y1="79.4648" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="480.5" x2="480.5" y1="79.4648" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="684" x2="684" y1="410.9111" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="814" x2="814" y1="79.4648" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="955" x2="955" y1="628.3271" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1067" x2="1067" y1="79.4648" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1187" x2="1187" y1="1049.1934" y2="1823.8398"/><line style="stroke:#181818;stroke-width:0.5;fill:none;stroke-dasharray:5.0,5.0;" x1="1336" x2="1336" y1="1141.1797" y2="1823.8398"/><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169" x="238.5" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="308" y="52.0234">ses :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="245.5" y="68.5117">ScriptExecutionService</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="169" x="238.5" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="308" y="1843.375">ses :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="245.5" y="1859.8633">ScriptExecutionService</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="417.5" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="462.5" y="52.0234">mgr :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="424.5" y="68.5117">ProcessManager</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="126" x="417.5" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="462.5" y="1843.375">mgr :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="424.5" y="1859.8633">ProcessManager</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="645" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="657.5" y="1843.375">work_q:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="652" y="1859.8633">MPQueue</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="734" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="800" y="52.0234">em :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="741" y="68.5117">EnvironmentManager</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="161" x="734" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="800" y="1843.375">em :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="741" y="1859.8633">EnvironmentManager</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="905" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="939.5" y="1843.375">env :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="912" y="1859.8633">Environment</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="1016" y="31.4883"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="1052.5" y="52.0234">ctx :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="1023" y="68.5117">MainContext</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="1016" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="1052.5" y="1843.375">ctx :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="1023" y="1859.8633">MainContext</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44" x="1165" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="1172" y="1843.375">Proc</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="1285" y="1822.8398"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="1292" y="1843.375">ScriptWorker</text><rect fill="none" height="1710.375" style="stroke:#000000;stroke-width:1.5;" width="1454" x="5" y="96.4648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="23" x="5" y="110.0332">par</text><ellipse cx="12.5" cy="167.8682" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="311,164.6182,321,168.6182,311,172.6182,315,168.6182" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="17" x2="317" y1="168.6182" y2="168.6182"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="20" y="163.876">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="33" y="163.876">prepare(cmd: PrepareProcessCommand)</text><path d="M328,118.7754 L328,204.7754 L584,204.7754 L584,128.7754 L574,118.7754 L328,118.7754 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M574,118.7754 L574,128.7754 L584,128.7754 L574,118.7754 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="334" y="136.3438">The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="361" y="136.02">prepare</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="421" y="136.3438">method of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="334" y="151.3306">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="514" y="151.6543">instance</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="334" y="166.9648">is called. For a REST deployment, the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="224" x="334" y="181.7739">ScriptExecutionServiceWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="334" y="197.4082">is the client making this method call.</text><polygon fill="#181818" points="468.5,276.3926,478.5,280.3926,468.5,284.3926,472.5,280.3926" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="323" x2="474.5" y1="280.3926" y2="280.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="330" y="275.6504">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="343" y="275.6504">create(...)</text><path d="M485,215.1504 L485,332.1504 L841,332.1504 L841,225.1504 L831,215.1504 L485,215.1504 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M831,215.1504 L831,225.1504 L841,225.1504 L831,215.1504 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="491" y="232.7188">The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="518" y="232.395">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="698" y="232.7188">is responsible</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="290" x="491" y="248.0293">for orchestrating control of domain objects to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="491" y="263.3398">satisfy the request. The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="643" y="263.0161">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="491" y="278.6504">invokes the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="568" y="278.3267">create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="620" y="278.6504">method of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="713" y="278.3267">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="491" y="293.9609">domain object to satisfy this request, passing the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="491" y="309.2715">script location and initialisation arguments extracted</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="491" y="324.582">from the PrepareProcessCommand object.</text><polygon fill="#181818" points="633,354.6348,643,358.6348,633,362.6348,637,358.6348" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="639" y1="358.6348" y2="358.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="353.8926">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="500.5" y="353.8926">«create»</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="79" x="645" y="371.9229"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="657.5" y="392.458">work_q:</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="65" x="652" y="408.9463">MPQueue</text><path d="M728.5,342.3242 L728.5,459.3242 L1110.5,459.3242 L1110.5,352.3242 L1100.5,342.3242 L728.5,342.3242 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1100.5,342.3242 L1100.5,352.3242 L1110.5,352.3242 L1100.5,342.3242 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="734.5" y="359.8926">Preparations for the new process begin. A new</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="56" x="1029.5" y="359.5688">MPQueue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="734.5" y="375.2031">is created that will be shared between</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="975.5" y="374.8794">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="734.5" y="390.5137">and the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="785.5" y="390.1899">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="885.5" y="390.5137">child process. Messages from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="734.5" y="405.5005">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="850.5" y="405.8242">to</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="867.5" y="405.5005">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="967.5" y="405.8242">will be added to this</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="734.5" y="421.1348">queue. Next,</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="818.5" y="420.811">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="934.5" y="421.1348">primes the work queue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="734.5" y="436.4453">with some instructions to be run by the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="987.5" y="436.1216">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="734.5" y="451.7559">immediately on process creation.</text><path d="M407.5,471.498 L469.5,471.498 L469.5,478.8086 L459.5,488.8086 L407.5,488.8086 L407.5,471.498 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="291.6582" style="stroke:#000000;stroke-width:1.5;" width="757" x="407.5" y="471.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="422.5" y="485.0664">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="426" x="484.5" y="484.1328">[script located in git repository and virtual environment creation requested]</text><polygon fill="#181818" points="802.5,524.4297,812.5,528.4297,802.5,532.4297,806.5,528.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="808.5" y1="528.4297" y2="528.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="523.6875">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="500.5" y="523.6875">create_env()</text><path d="M819,493.8086 L819,548.8086 L1149,548.8086 L1149,503.8086 L1139,493.8086 L819,493.8086 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1139,493.8086 L1139,503.8086 L1149,503.8086 L1139,493.8086 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="825" y="511.0532">EnvironmentManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="973" y="511.377">creates a new empty</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="825" y="526.6875">Python virtual environment is created, referenced</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="825" y="541.998">by the git commit hash.</text><polygon fill="#181818" points="893,572.0508,903,576.0508,893,580.0508,897,576.0508" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="814.5" x2="899" y1="576.0508" y2="576.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="821.5" y="571.3086">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="834.5" y="571.3086">«create»</text><rect fill="#E2E2F0" height="46.9766" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="101" x="905" y="589.3389"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32" x="939.5" y="609.874">env :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="912" y="626.3623">Environment</text><path d="M492,559.7402 L492,676.7402 L809,676.7402 L809,569.7402 L799,559.7402 L492,559.7402 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M799,559.7402 L799,569.7402 L809,569.7402 L799,559.7402 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="498" y="577.3086">An</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="519" y="576.9849">Environment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="611" y="577.3086">object is created holding</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="271" x="498" y="592.6191">information on the virtual environment (ID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="498" y="607.9297">paths, etc) and som</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="626" y="607.606">multiprocessing.Event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="498" y="623.2402">objects which are used to synchronise</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="498" y="638.2271">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="598" y="638.5508">instances, ensuring that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="291" x="498" y="653.8613">concurrent requests do not try to initialise the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="498" y="669.1719">same virtual environment.</text><polygon fill="#181818" points="672.5,725.1904,682.5,729.1904,672.5,733.1904,676.5,729.1904" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="678.5" y1="729.1904" y2="729.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="724.4482">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="500.5" y="724.4482">safe_put(«</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="565.5" y="724.1245">ENV</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="593.5" y="724.4482">message»)</text><path d="M689,686.9141 L689,757.9141 L1094,757.9141 L1094,696.9141 L1084,686.9141 L689,686.9141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1084,686.9141 L1084,696.9141 L1094,696.9141 L1084,686.9141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="695" y="704.4824">A</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="708" y="704.1587">ENV</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="736" y="704.4824">message is added to the ScriptWorker work</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="69" x="695" y="719.793">queue. The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="768" y="719.4692">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="868" y="719.793">will initialise the new Python</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="378" x="695" y="735.1035">virtual environment when this message is processed, whose</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="695" y="750.4141">message paylooad includes the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="896" y="750.0903">Environment</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="988" y="750.4141">created above.</text><polygon fill="#181818" points="672.5,798.1221,682.5,802.1221,672.5,806.1221,676.5,802.1221" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="678.5" y1="802.1221" y2="802.1221"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="797.3799">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="500.5" y="797.3799">safe_put(«</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="565.5" y="797.0562">LOAD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="601.5" y="797.3799">message»)</text><path d="M689,775.1563 L689,815.1563 L1014,815.1563 L1014,785.1563 L1004,775.1563 L689,775.1563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1004,775.1563 L1004,785.1563 L1014,785.1563 L1004,775.1563 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="695" y="792.7246">A</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="708" y="792.4009">LOAD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="744" y="792.7246">message to load the user script is added</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="695" y="808.0352">to the child process work queue.</text><polygon fill="#181818" points="672.5,848.7432,682.5,852.7432,672.5,856.7432,676.5,852.7432" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="678.5" y1="852.7432" y2="852.7432"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="848.001">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="500.5" y="848.001">safe_put(«</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="565.5" y="847.6772">RUN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="593.5" y="848.001">message»)</text><path d="M689,825.7773 L689,865.7773 L1072,865.7773 L1072,835.7773 L1062,825.7773 L689,825.7773 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1062,825.7773 L1062,835.7773 L1072,835.7773 L1062,825.7773 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="695" y="843.3457">A</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="24" x="708" y="843.022">RUN</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="736" y="843.3457">message to run the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="861" y="843.022">init</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="897" y="843.3457">method of the user script</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="695" y="858.6563">(if present) is added to the child process work queue.</text><polygon fill="#181818" points="1055,922.3301,1065,926.3301,1055,930.3301,1059,926.3301" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="1061" y1="926.3301" y2="926.3301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="487.5" y="921.5879">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="500.5" y="921.5879">Proc(...)</text><path d="M118,876.3984 L118,962.3984 L475,962.3984 L475,886.3984 L465,876.3984 L118,876.3984 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M465,876.3984 L465,886.3984 L475,886.3984 L465,876.3984 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="124" y="893.9668">Rather than creating a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="266" y="893.6431">Proc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="302" y="893.9668">instance directly, the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="144" x="124" y="908.9536">MainContext.Proc()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="272" y="909.2773">constructor is called to create</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="124" y="924.5879">the new</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="177" y="924.2642">Proc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="213" y="924.5879">instance within the context of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="124" y="939.5747">MainContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="212" y="939.8984">, which allows the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="88" x="329" y="939.5747">MainContext</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="421" y="939.8984">to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="124" y="955.209">manage the lifecycle of the child process.</text><polygon fill="#181818" points="1153,985.2617,1163,989.2617,1153,993.2617,1157,989.2617" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1067" x2="1159" y1="989.2617" y2="989.2617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1074" y="984.5195">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1096" y="984.5195">«create»</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="44" x="1165" y="1018.4492"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="1172" y="1038.9844">Proc</text><path d="M538,972.9512 L538,1104.9512 L1062,1104.9512 L1062,982.9512 L1052,972.9512 L538,972.9512 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1052,972.9512 L1052,982.9512 L1062,982.9512 L1052,972.9512 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="544" y="990.5195">The new</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="600" y="990.1958">Proc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="636" y="990.5195">instance is created, which is the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="842" y="990.1958">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="954" y="990.5195">'s handle and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="544" y="1005.8301">reference to the child process.</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="739" y="1005.5063">Proc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="775" y="1005.8301">arguments include:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="544" y="1021.1406"> </text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="363" x="544" y="1036.4512">1. The class the child process should run, in this case the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="911" y="1036.1274">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="1011" y="1036.4512">class;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="544" y="1051.7617">2. The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="48" x="587" y="1051.438">work_q</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="635" y="1051.7617"> </text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="40" x="639" y="1051.438">Queue</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="683" y="1051.7617">primed with the initial messages/instructions to parse;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="544" y="1067.0723">3. A set of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="617" y="1066.7485">multiprocessing.Events</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="797" y="1067.0723">which the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="862" y="1066.7485">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="962" y="1067.0723">sets during</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="560" y="1082.3828">initialsation and the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="690" y="1082.0591">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="806" y="1082.3828">monitors to track successful process</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="560" y="1097.6934">creation and initialisation.</text><polygon fill="#181818" points="1273,1127.7461,1283,1131.7461,1273,1135.7461,1277,1131.7461" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1187" x2="1279" y1="1131.7461" y2="1131.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1194" y="1127.0039">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1216" y="1127.0039">«create»</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="102" x="1285" y="1110.4355"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="88" x="1292" y="1130.9707">ScriptWorker</text><rect height="81.8418" style="stroke:#000000;stroke-width:1.5;fill:none;" width="118" x="1282" y="1151.9238"/><path d="M1282,1151.9238 L1346,1151.9238 L1346,1158.9238 L1336,1168.9238 L1282,1168.9238 L1282,1151.9238 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1295" y="1166.4922">ref</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="4" x="1339" y="1184.5254"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="20" x="1331" y="1198.6582">See</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="102" x="1294" y="1212.791">seq: ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="4" x="1339" y="1226.9238"> </text><rect fill="none" height="344.2793" style="stroke:#000000;stroke-width:1.5;" width="1444" x="5" y="1245.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="15" y="1259.334">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="310" x="77" y="1258.4004">[ScriptWorker launch successful within timeout period]</text><polygon fill="#181818" points="334,1321.6631,324,1325.6631,334,1329.6631,330,1325.6631" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="328" x2="479.5" y1="1325.6631" y2="1325.6631"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="340" y="1320.9209">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="362" y="1320.9209">ScriptWorker ID</text><path d="M485,1268.0762 L485,1369.0762 L825,1369.0762 L825,1278.0762 L815,1268.0762 L485,1268.0762 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M815,1268.0762 L815,1278.0762 L825,1278.0762 L815,1268.0762 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="491" y="1285.3208">Proc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="527" y="1285.6445">monitors the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="612" y="1285.3208">multiprocessing.Event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="308" x="491" y="1300.9551">instances to check whether process creation was</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="491" y="1316.2656">successful. If the events were set within the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="491" y="1331.5762">timeout period, signifying that the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="712" y="1331.2524">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="491" y="1346.8867">process creation was successful, the ID of the new</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="491" y="1361.8735">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="591" y="1362.1973">is returned.</text><polygon fill="#181818" points="16,1410.5605,6,1414.5605,16,1418.5605,12,1414.5605" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="322" y1="1414.5605" y2="1414.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="22" y="1409.8184">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="44" y="1409.8184">return</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="86" y="1409.4946">ProcedureSummary</text><path d="M328,1379.9395 L328,1434.9395 L630,1434.9395 L630,1389.9395 L620,1379.9395 L328,1379.9395 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M620,1379.9395 L620,1389.9395 L630,1389.9395 L620,1379.9395 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="334" y="1397.5078">The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="176" x="361" y="1397.1841">ScriptExecutionService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="541" y="1397.5078">returns a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="334" y="1412.4946">ProcedureSummary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="466" y="1412.8184">object summarising the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="334" y="1428.1289">current status of the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="467" y="1427.8052">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="563" y="1428.1289">.</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="5" x2="1449" y1="1441.8711" y2="1441.8711"/><polygon fill="#181818" points="1324,1493.8027,1334,1497.8027,1324,1501.8027,1328,1497.8027" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1187" x2="1330" y1="1497.8027" y2="1497.8027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1194" y="1493.0605">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1216" y="1493.0605"> </text><path d="M853,1447.8711 L853,1533.8711 L1182,1533.8711 L1182,1457.8711 L1172,1447.8711 L853,1447.8711 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1172,1447.8711 L1172,1457.8711 L1182,1457.8711 L1172,1447.8711 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="32" x="859" y="1465.1157">Proc</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="895" y="1465.4395">monitors the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="168" x="980" y="1465.1157">multiprocessing.Event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="308" x="859" y="1480.75">instances to check whether process creation was</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="859" y="1496.0605">successful. If they are not set within the timeout</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="859" y="1511.3711">period, ScriptWorker creation is considered a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="859" y="1526.6816">failure and the process is terminated.</text><line style="stroke:#A80036;stroke-width:2.0;" x1="1327" x2="1345" y1="1488.8027" y2="1506.8027"/><line style="stroke:#A80036;stroke-width:2.0;" x1="1327" x2="1345" y1="1506.8027" y2="1488.8027"/><polygon fill="#181818" points="16,1567.3896,6,1571.3896,16,1575.3896,12,1571.3896" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1186" y1="1571.3896" y2="1571.3896"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="22" y="1566.6475">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62" x="44" y="1566.6475">exception</text><path d="M1192,1544.4238 L1192,1584.4238 L1434,1584.4238 L1434,1554.4238 L1424,1544.4238 L1192,1544.4238 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1424,1544.4238 L1424,1554.4238 L1434,1554.4238 L1424,1544.4238 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="1198" y="1561.9922">An exception describing the failure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="1198" y="1577.3027">to create the process is raised.</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="5" x2="1459" y1="1598.0449" y2="1598.0449"/><path d="M125,1606.0449 L199,1606.0449 L199,1613.3555 L189,1623.3555 L125,1623.3555 L125,1606.0449 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="193.7949" style="stroke:#000000;stroke-width:1.5;" width="932.5" x="125" y="1606.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="140" y="1619.6133">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="259" x="214" y="1618.6797">[every message received from a ScriptWorker]</text><ellipse cx="338" cy="1643.916" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="468.5,1640.666,478.5,1644.666,468.5,1648.666,472.5,1644.666" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="342.5" x2="474.5" y1="1644.666" y2="1644.666"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="345.5" y="1639.9238">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="367.5" y="1639.9238">EventMessage</text><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="522.5" y1="1701.0977" y2="1701.0977"/><line style="stroke:#181818;stroke-width:1.0;" x1="522.5" x2="522.5" y1="1701.0977" y2="1714.0977"/><line style="stroke:#181818;stroke-width:1.0;" x1="481.5" x2="522.5" y1="1714.0977" y2="1714.0977"/><polygon fill="#181818" points="491.5,1710.0977,481.5,1714.0977,491.5,1718.0977,487.5,1714.0977" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="487.5" y="1696.3555">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="509.5" y="1696.3555">«handle event»</text><path d="M615,1657.666 L615,1743.666 L1042,1743.666 L1042,1667.666 L1032,1657.666 L615,1657.666 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1032,1657.666 L1032,1667.666 L1042,1667.666 L1032,1657.666 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="621" y="1675.2344">Every message received from the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="831" y="1674.9106">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="931" y="1675.2344">is parsed and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="621" y="1690.5449">acted on by the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="722" y="1690.2212">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="834" y="1690.5449">. The action depends on the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="621" y="1705.8555">message type. For instance, state change events result</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="621" y="1721.166">in an update to the</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="744" y="1720.8423">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="856" y="1721.166">'s record of</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="96" x="931" y="1720.8423">ScriptWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="621" y="1736.4766">state.</text><ellipse cx="636" cy="1780.4346" fill="none" rx="4" ry="4" style="stroke:#181818;stroke-width:1.5;"/><polygon fill="#181818" points="619,1777.1846,629,1781.1846,619,1785.1846,623,1781.1846" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="480.5" x2="625" y1="1781.1846" y2="1781.1846"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="487.5" y="1776.4424">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="509.5" y="1776.4424">«EventMessage»</text><path d="M135,1754.2188 L135,1794.2188 L475,1794.2188 L475,1764.2188 L465,1754.2188 L135,1754.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M465,1754.2188 L465,1764.2188 L475,1764.2188 L465,1754.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="141" y="1771.7871">The</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="168" y="1771.4634">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="284" y="1771.7871">relays the message to every</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="319" x="141" y="1787.0977">callback function that is registered as an observer.</text><!--MD5=[8704b894677dd88cc4836f87ffcd5d62]
@startuml
'https://plantuml.com/sequence-diagram

mainframe seq: ScriptExecutionService.prepare

autonumber

participant "ses :\nScriptExecutionService" as ScriptExecutionService
participant "mgr :\nProcessManager" as ProcessManager
participant "work_q:\nMPQueue" as work_q
participant "em :\nEnvironmentManager" as EnvironmentManager
participant "env :\nEnvironment" as Environment
participant "ctx :\nMainContext" as MainContext


par

[o-> ScriptExecutionService: prepare(cmd: PrepareProcessCommand)
note right
The ""prepare"" method of the
""ScriptExecutionService"" instance
is called. For a REST deployment, the
""ScriptExecutionServiceWorker""
is the client making this method call.
end note

ScriptExecutionService -> ProcessManager: create(...)
note right
The ""ScriptExecutionService"" is responsible
for orchestrating control of domain objects to
satisfy the request. The ""ScriptExecutionService""
invokes the ""create"" method of the ""ProcessManager""
domain object to satisfy this request, passing the
script location and initialisation arguments extracted
from the PrepareProcessCommand object.
end note

create work_q
ProcessManager -> work_q: «create»
note right
Preparations for the new process begin. A new ""MPQueue""
is created that will be shared between ""ProcessManager""
and the ""ScriptWorker"" child process. Messages from
""ProcessManager"" to ""ScriptWorker"" will be added to this
queue. Next, ""ProcessManager"" primes the work queue
with some instructions to be run by the ""ScriptWorker""
immediately on process creation.
end note

alt script located in git repository and virtual environment creation requested
    ProcessManager -> EnvironmentManager: create_env()
    note right
    ""EnvironmentManager"" creates a new empty
    Python virtual environment is created, referenced
    by the git commit hash.
    end note

    create Environment
    EnvironmentManager -> Environment: «create»
    note left
    An ""Environment"" object is created holding
    information on the virtual environment (ID,
    paths, etc) and som ""multiprocessing.Event""
    objects which are used to synchronise
    ""ScriptWorker"" instances, ensuring that
    concurrent requests do not try to initialise the
    same virtual environment.
    end note

    ProcessManager -> work_q: safe_put(«""ENV"" message»)
    note right
    A ""ENV"" message is added to the ScriptWorker work
    queue. The ""ScriptWorker"" will initialise the new Python
    virtual environment when this message is processed, whose
    message paylooad includes the ""Environment"" created above.
    end note
end

ProcessManager -> work_q: safe_put(«""LOAD"" message»)
note right
A ""LOAD"" message to load the user script is added
to the child process work queue.
end note

ProcessManager -> work_q: safe_put(«""RUN"" message»)
note right
A ""RUN"" message to run the ""init"" method of the user script
(if present) is added to the child process work queue.
end note

ProcessManager -> MainContext: Proc(...)
note left
Rather than creating a ""Proc"" instance directly, the
""MainContext.Proc()"" constructor is called to create
the new ""Proc"" instance within the context of the
""MainContext"", which allows the ""MainContext"" to
manage the lifecycle of the child process.
end note

create Proc
MainContext -> Proc: «create»
note left
The new ""Proc"" instance is created, which is the ""ProcessManager""'s handle and
reference to the child process. ""Proc"" arguments include:

1. The class the child process should run, in this case the ""ScriptWorker"" class;
2. The ""work_q"" ""Queue"" primed with the initial messages/instructions to parse;
3. A set of  ""multiprocessing.Events"" which the ""ScriptWorker"" sets during
    initialsation and the ""ProcessManager"" monitors to track successful process
    creation and initialisation.
end note

create ScriptWorker
Proc -> ScriptWorker: «create»
ref over ScriptWorker

See
  seq: ScriptWorker

end

alt ScriptWorker launch successful within timeout period
ProcessManager - -> ScriptExecutionService: ScriptWorker ID
note right
""Proc"" monitors the ""multiprocessing.Event""
instances to check whether process creation was
successful. If the events were set within the
timeout period, signifying that the ""ScriptWorker""
process creation was successful, the ID of the new
""ScriptWorker"" is returned.
end note

[<- - ScriptExecutionService : return ""ProcedureSummary""
note right
The ""ScriptExecutionService"" returns a
""ProcedureSummary"" object summarising the
current status of the ""ScriptWorker"".
end note

else
Proc -> ScriptWorker !!
note left
""Proc"" monitors the ""multiprocessing.Event""
instances to check whether process creation was
successful. If they are not set within the timeout
period, ScriptWorker creation is considered a
failure and the process is terminated.
end note

[<- - Proc : exception
note left
An exception describing the failure
to create the process is raised.
end note
end

else

loop every message received from a ScriptWorker
?o-> ProcessManager : EventMessage
ProcessManager -> ProcessManager: «handle event»
note right
Every message received from the ""ScriptWorker"" is parsed and
acted on by the ""ProcessManager"". The action depends on the
message type. For instance, state change events result
in an update to the ""ProcessManager""'s record of ""ScriptWorker""
state.
end note

ProcessManager ->o?: «EventMessage»
note right
The ""ProcessManager"" relays the message to every
callback function that is registered as an observer.
end note

end

end

@enduml

@startuml

mainframe seq: ScriptExecutionService.prepare

autonumber

participant "ses :\nScriptExecutionService" as ScriptExecutionService
participant "mgr :\nProcessManager" as ProcessManager
participant "work_q:\nMPQueue" as work_q
participant "em :\nEnvironmentManager" as EnvironmentManager
participant "env :\nEnvironment" as Environment
participant "ctx :\nMainContext" as MainContext


par

[o-> ScriptExecutionService: prepare(cmd: PrepareProcessCommand)
note right
The ""prepare"" method of the
""ScriptExecutionService"" instance
is called. For a REST deployment, the
""ScriptExecutionServiceWorker""
is the client making this method call.
end note

ScriptExecutionService -> ProcessManager: create(...)
note right
The ""ScriptExecutionService"" is responsible
for orchestrating control of domain objects to
satisfy the request. The ""ScriptExecutionService""
invokes the ""create"" method of the ""ProcessManager""
domain object to satisfy this request, passing the
script location and initialisation arguments extracted
from the PrepareProcessCommand object.
end note

create work_q
ProcessManager -> work_q: «create»
note right
Preparations for the new process begin. A new ""MPQueue""
is created that will be shared between ""ProcessManager""
and the ""ScriptWorker"" child process. Messages from
""ProcessManager"" to ""ScriptWorker"" will be added to this
queue. Next, ""ProcessManager"" primes the work queue
with some instructions to be run by the ""ScriptWorker""
immediately on process creation.
end note

alt script located in git repository and virtual environment creation requested
    ProcessManager -> EnvironmentManager: create_env()
    note right
    ""EnvironmentManager"" creates a new empty
    Python virtual environment is created, referenced
    by the git commit hash.
    end note

    create Environment
    EnvironmentManager -> Environment: «create»
    note left
    An ""Environment"" object is created holding
    information on the virtual environment (ID,
    paths, etc) and som ""multiprocessing.Event""
    objects which are used to synchronise
    ""ScriptWorker"" instances, ensuring that
    concurrent requests do not try to initialise the
    same virtual environment.
    end note

    ProcessManager -> work_q: safe_put(«""ENV"" message»)
    note right
    A ""ENV"" message is added to the ScriptWorker work
    queue. The ""ScriptWorker"" will initialise the new Python
    virtual environment when this message is processed, whose
    message paylooad includes the ""Environment"" created above.
    end note
end

ProcessManager -> work_q: safe_put(«""LOAD"" message»)
note right
A ""LOAD"" message to load the user script is added
to the child process work queue.
end note

ProcessManager -> work_q: safe_put(«""RUN"" message»)
note right
A ""RUN"" message to run the ""init"" method of the user script
(if present) is added to the child process work queue.
end note

ProcessManager -> MainContext: Proc(...)
note left
Rather than creating a ""Proc"" instance directly, the
""MainContext.Proc()"" constructor is called to create
the new ""Proc"" instance within the context of the
""MainContext"", which allows the ""MainContext"" to
manage the lifecycle of the child process.
end note

create Proc
MainContext -> Proc: «create»
note left
The new ""Proc"" instance is created, which is the ""ProcessManager""'s handle and
reference to the child process. ""Proc"" arguments include:

1. The class the child process should run, in this case the ""ScriptWorker"" class;
2. The ""work_q"" ""Queue"" primed with the initial messages/instructions to parse;
3. A set of  ""multiprocessing.Events"" which the ""ScriptWorker"" sets during
    initialsation and the ""ProcessManager"" monitors to track successful process
    creation and initialisation.
end note

create ScriptWorker
Proc -> ScriptWorker: «create»
ref over ScriptWorker

See
  seq: ScriptWorker

end

alt ScriptWorker launch successful within timeout period
ProcessManager - -> ScriptExecutionService: ScriptWorker ID
note right
""Proc"" monitors the ""multiprocessing.Event""
instances to check whether process creation was
successful. If the events were set within the
timeout period, signifying that the ""ScriptWorker""
process creation was successful, the ID of the new
""ScriptWorker"" is returned.
end note

[<- - ScriptExecutionService : return ""ProcedureSummary""
note right
The ""ScriptExecutionService"" returns a
""ProcedureSummary"" object summarising the
current status of the ""ScriptWorker"".
end note

else
Proc -> ScriptWorker !!
note left
""Proc"" monitors the ""multiprocessing.Event""
instances to check whether process creation was
successful. If they are not set within the timeout
period, ScriptWorker creation is considered a
failure and the process is terminated.
end note

[<- - Proc : exception
note left
An exception describing the failure
to create the process is raised.
end note
end

else

loop every message received from a ScriptWorker
?o-> ProcessManager : EventMessage
ProcessManager -> ProcessManager: «handle event»
note right
Every message received from the ""ScriptWorker"" is parsed and
acted on by the ""ProcessManager"". The action depends on the
message type. For instance, state change events result
in an update to the ""ProcessManager""'s record of ""ScriptWorker""
state.
end note

ProcessManager ->o?: «EventMessage»
note right
The ""ProcessManager"" relays the message to every
callback function that is registered as an observer.
end note

end

end

@enduml

PlantUML version 1.2022.5(Sat Apr 30 11:55:52 BST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>