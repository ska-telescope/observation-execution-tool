<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1374px" preserveAspectRatio="none" style="width:1893px;height:1374px;" version="1.1" viewBox="0 0 1893 1374" width="1893px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rd7cqprzqpr1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1rd7cqprzqpr1)" height="1360.6563" style="stroke: #000000; stroke-width: 1.0;" width="1874" x="8" y="3"/><path d="M191,4 L191,12.2969 L181,22.2969 L8,22.2969 " fill="none" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="11" y="16.9951">Activity API over REST</text><rect fill="#FFFFFF" filter="url(#f1rd7cqprzqpr1)" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="230" x="737.5" y="409.75"/><rect fill="#FFFFFF" filter="url(#f1rd7cqprzqpr1)" height="334.125" style="stroke: #000000; stroke-width: 2.0;" width="1070" x="521" y="957.9375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="64" x2="64" y1="80.8906" y2="1309.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="328" x2="328" y1="80.8906" y2="1309.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="588" x2="588" y1="80.8906" y2="1309.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="804.5" x2="804.5" y1="80.8906" y2="1309.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="975.5" x2="975.5" y1="80.8906" y2="1309.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1193.5" x2="1193.5" y1="80.8906" y2="1309.0625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1493" x2="1493" y1="80.8906" y2="1309.0625"/><rect fill="#90EE90" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="13" y="29.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="47.5" y="49.292">CLI :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="20" y="65.5889">RestClientUI</text><rect fill="#90EE90" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="13" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="47.5" y="1328.0576">CLI :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="20" y="1344.3545">RestClientUI</text><rect fill="#ADD8E6" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="264" y="29.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="271" y="49.292">REST backend :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="284" y="65.5889">FlaskWorker</text><rect fill="#ADD8E6" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="124" x="264" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="271" y="1328.0576">REST backend :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="284" y="1344.3545">FlaskWorker</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="531" y="45.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="538" y="65.5889">ActivityWorker</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="531" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="538" y="1328.0576">ActivityWorker</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="747.5" y="45.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="754.5" y="65.5889">ActivityService</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="747.5" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="754.5" y="1328.0576">ActivityService</text><rect fill="#ADD8E6" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="880.5" y="29.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="954" y="49.292">ODA :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="887.5" y="65.5889">Observation Data Archive</text><rect fill="#ADD8E6" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="187" x="880.5" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="954" y="1328.0576">ODA :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="173" x="887.5" y="1344.3545">Observation Data Archive</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="220" x="1081.5" y="29.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1149" y="49.292">SESWorker :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="206" x="1088.5" y="65.5889">ScriptExecutionServiceWorker</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="220" x="1081.5" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1149" y="1328.0576">SESWorker :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="206" x="1088.5" y="1344.3545">ScriptExecutionServiceWorker</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1406" y="29.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1419" y="49.292">Script Execution API :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1413" y="65.5889">ScriptExecutionService</text><rect fill="#FEFECE" filter="url(#f1rd7cqprzqpr1)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1406" y="1308.0625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="145" x="1419" y="1328.0576">Script Execution API :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="1413" y="1344.3545">ScriptExecutionService</text><polygon fill="#A80036" points="316,143.2891,326,147.2891,316,151.2891,320,147.2891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="64" x2="322" y1="147.2891" y2="147.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="71" y="142.2231">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="84" y="142.2231">HTTP POST to /api/v1/activities</text><path d="M333,95.8906 L333,180.8906 L632,180.8906 L632,105.8906 L622,95.8906 L333,95.8906 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M622,95.8906 L622,105.8906 L632,105.8906 L622,95.8906 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="339" y="112.9575">The User executes an OET CLI command at</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="339" y="128.0903">the terminal. The OET CLI uses HTTP POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="257" x="339" y="143.2231">to send a JSON object encapsulating the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="339" y="158.356">request (activity name, scheduling block ID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="339" y="173.4888">etc.) to the REST backend.</text><polygon fill="#A80036" points="576,242.9531,586,246.9531,576,250.9531,580,246.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="328" x2="582" y1="246.9531" y2="246.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="335" y="241.8872">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="348" y="241.8872">send message request.activity.run</text><path d="M593,195.5547 L593,280.5547 L938,280.5547 L938,205.5547 L928,195.5547 L593,195.5547 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M928,195.5547 L928,205.5547 L938,205.5547 L928,195.5547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="599" y="212.6216">FlaskWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="691" y="212.6216">creates a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="755" y="212.6216">ActivityCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="315" x="599" y="227.7544">encapsulating the request details and announces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="599" y="242.8872">the event on the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="146" x="709" y="242.8872">Run Activity requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="859" y="242.8872">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="599" y="258.02">topic. It will then wait for a response on the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="48" x="875" y="258.02">Activity</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="48" x="599" y="273.1528">running</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="651" y="273.1528">response topic.</text><polygon fill="#A80036" points="793,307.3516,803,311.3516,793,315.3516,797,311.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="588" x2="799" y1="311.3516" y2="311.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="595" y="306.2856">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="608" y="306.2856">run(cmd: ActivityCommand)</text><polygon fill="#A80036" points="964,349.0508,974,353.0508,964,357.0508,968,353.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="805" x2="970" y1="353.0508" y2="353.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="812" y="347.9849">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="825" y="347.9849">oda.sbds.get(sbd_id)</text><path d="M981,324.3516 L981,364.3516 L1335,364.3516 L1335,334.3516 L1325,324.3516 L981,324.3516 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1325,324.3516 L1325,334.3516 L1335,334.3516 L1325,324.3516 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="987" y="341.4185">Retrieve the Scheduling Block Definition from ODA.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="333" x="987" y="356.5513">The ODA client will return a SBDefinition PDM object.</text><polygon fill="#A80036" points="816,390.75,806,394.75,816,398.75,812,394.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="810" x2="975" y1="394.75" y2="394.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="822" y="389.6841">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="835" y="389.6841">pdm.SBDefinition</text><path d="M737.5,409.75 L807.5,409.75 L807.5,416.75 L797.5,426.75 L737.5,426.75 L737.5,409.75 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.2656" style="stroke: #000000; stroke-width: 2.0;" width="230" x="737.5" y="409.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="752.5" y="422.8169">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="822.5" y="421.9604">[script_args provided]</text><path d="M972.5,414.75 L972.5,469.75 L1363.5,469.75 L1363.5,424.75 L1353.5,414.75 L972.5,414.75 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1353.5,414.75 L1353.5,424.75 L1363.5,424.75 L1353.5,414.75 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="354" x="978.5" y="431.8169">If user has provided additional arguments for the script,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="978.5" y="446.9497">the retrieved SB is updated to include any additional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="370" x="978.5" y="462.0825">arguments and overwrite any existing keyword arguments</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="805" x2="847" y1="448.0156" y2="448.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="847" x2="847" y1="448.0156" y2="461.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="806" x2="847" y1="461.0156" y2="461.0156"/><polygon fill="#A80036" points="816,457.0156,806,461.0156,816,465.0156,812,461.0156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="812" y="442.9497">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="825" y="442.9497">update SB args</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="805" x2="847" y1="518.3477" y2="518.3477"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="847" x2="847" y1="518.3477" y2="531.3477"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="806" x2="847" y1="531.3477" y2="531.3477"/><polygon fill="#A80036" points="816,527.3477,806,531.3477,816,535.3477,812,531.3477" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="812" y="513.2817">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="825" y="513.2817">write SB to file</text><path d="M928,481.0156 L928,551.0156 L1323,551.0156 L1323,491.0156 L1313,481.0156 L928,481.0156 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1313,481.0156 L1313,491.0156 L1323,491.0156 L1313,481.0156 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="934" y="498.0825">ActivityService will write SB JSON to file with a unique</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="934" y="513.2153">name consisting of SB ID, SB version and timestamp. SBs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="934" y="528.3481">are stored in folder /tmp/sbs/ and path to the SB is passed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="934" y="543.481">as an argument in the PrepareProcessCommand</text><polygon fill="#A80036" points="1181.5,612.9453,1191.5,616.9453,1181.5,620.9453,1185.5,616.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="805" x2="1187.5" y1="616.9453" y2="616.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="812" y="611.8794">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="825" y="611.8794">message request.procedure.prepare</text><path d="M1198,565.5469 L1198,650.5469 L1585,650.5469 L1585,575.5469 L1575,565.5469 L1198,565.5469 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1575,565.5469 L1575,575.5469 L1585,575.5469 L1575,565.5469 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="356" x="1204" y="582.6138">ActivityService creates a PrepareProcessCommand and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="327" x="1204" y="597.7466">announces it on the Create Procedure topic. It then</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="1204" y="612.8794">waits for the response topic Procedure Created and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="366" x="1204" y="628.0122">creates an ActivitySummary based on  the response that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="1204" y="643.145">is passed on to the REST backend and client.</text><polygon fill="#A80036" points="1481.5,677.3438,1491.5,681.3438,1481.5,685.3438,1485.5,681.3438" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1193.5" x2="1487.5" y1="681.3438" y2="681.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1200.5" y="676.2778">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="1213.5" y="676.2778">prepare(cmd: PrepareProcessCommand)</text><polygon fill="#A80036" points="1204.5,706.4766,1194.5,710.4766,1204.5,714.4766,1200.5,710.4766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1198.5" x2="1492.5" y1="710.4766" y2="710.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1210.5" y="705.4106">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1232.5" y="705.4106">ProcedureSummary</text><polygon fill="#A80036" points="816,735.6094,806,739.6094,816,743.6094,812,739.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="810" x2="1192.5" y1="739.6094" y2="739.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="822" y="734.5435">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="844" y="734.5435">message procedure.lifecycle.preparing</text><polygon fill="#A80036" points="599,764.7422,589,768.7422,599,772.7422,595,768.7422" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="593" x2="804" y1="768.7422" y2="768.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="605" y="763.6763">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="627" y="763.6763">ActivitySummary</text><polygon fill="#A80036" points="339,793.875,329,797.875,339,801.875,335,797.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="333" x2="587" y1="797.875" y2="797.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="345" y="792.8091">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="367" y="792.8091">message activity.lifecycle.running</text><polygon fill="#A80036" points="75,880.9727,65,884.9727,75,888.9727,71,884.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="69" x2="327" y1="884.9727" y2="884.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="81" y="879.9067">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="103" y="879.9067">HTTP OK + ActivitySummary JSON</text><path d="M333,810.875 L333,941.875 L688,941.875 L688,820.875 L678,810.875 L333,810.875 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M678,810.875 L678,820.875 L688,820.875 L678,810.875 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="339" y="827.9419">The FlaskWorker will block the client side until it</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="339" y="843.0747">receives a message on activity.lifecycle.running</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="339" y="858.2075">topic from the ActivityWorker indicating that the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="339" y="873.3403">preparation on the activity has been started.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="339" y="888.4731">Afterwards the user can stay updated on the activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="339" y="903.606">status by querying the procedure CLI with the script</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="339" y="918.7388">ID given by the ActivitySummary or by listening to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="339" y="933.8716">the lifecycle events.</text><path d="M521,957.9375 L591,957.9375 L591,964.9375 L581,974.9375 L521,974.9375 L521,957.9375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="334.125" style="stroke: #000000; stroke-width: 2.0;" width="1070" x="521" y="957.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="536" y="971.0044">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="606" y="970.1479">[prepare_only not set]</text><path d="M1596,962.9375 L1596,1077.9375 L1875,1077.9375 L1875,972.9375 L1865,962.9375 L1596,962.9375 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1865,962.9375 L1865,972.9375 L1875,972.9375 L1865,962.9375 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="1602" y="980.0044">If prepare_only flag is not set, the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="1602" y="995.1372">ActivityService creates and announces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1602" y="1010.27">a StartProcessCommand and waits for a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1602" y="1025.4028">response on  procedure.lifecycle.started</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="1602" y="1040.5356">topic. Once it gets the response, it</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="1602" y="1055.6685">creates an ActivitySummary object that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="1602" y="1070.8013">is returned to the ActivityWorker.</text><polygon fill="#A80036" points="1181.5,1042.6016,1191.5,1046.6016,1181.5,1050.6016,1185.5,1046.6016" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="805" x2="1187.5" y1="1046.6016" y2="1046.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="812" y="1041.5356">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="834" y="1041.5356">message request.procedure.start (force=true)</text><path d="M1198,980.0703 L1198,1095.0703 L1516,1095.0703 L1516,990.0703 L1506,980.0703 L1198,980.0703 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1506,980.0703 L1506,990.0703 L1516,990.0703 L1506,980.0703 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1204" y="997.1372">By default the ScriptExecutionServiceWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="293" x="1204" y="1012.27">does not allow a StartProcessCommand to be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="1204" y="1027.4028">queued if the process is not yet ready to start.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="1204" y="1042.5356">Instead of the ActivityService waiting for the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1204" y="1057.6685">process to be ready, set a flag to tell the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="1204" y="1072.8013">SESWorker to ignore the current process state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="1204" y="1087.9341">and queue the start command anyway.</text><polygon fill="#A80036" points="1481.5,1122.1328,1491.5,1126.1328,1481.5,1130.1328,1485.5,1126.1328" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1193.5" x2="1487.5" y1="1126.1328" y2="1126.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1200.5" y="1121.0669">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="1222.5" y="1121.0669">start(cmd: StartProcessCommand)</text><polygon fill="#A80036" points="1204.5,1151.2656,1194.5,1155.2656,1204.5,1159.2656,1200.5,1155.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1198.5" x2="1492.5" y1="1155.2656" y2="1155.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1210.5" y="1150.1997">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1232.5" y="1150.1997">ProcedureSummary</text><polygon fill="#A80036" points="816,1180.3984,806,1184.3984,816,1188.3984,812,1184.3984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="810" x2="1192.5" y1="1184.3984" y2="1184.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="822" y="1179.3325">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="844" y="1179.3325">message procedure.lifecycle.started</text><polygon fill="#A80036" points="599,1244.7969,589,1248.7969,599,1252.7969,595,1248.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="593" x2="804" y1="1248.7969" y2="1248.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="605" y="1243.731">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="627" y="1243.731">ActivitySummary</text><path d="M810,1197.3984 L810,1282.3984 L1112,1282.3984 L1112,1207.3984 L1102,1197.3984 L810,1197.3984 " fill="#FBFB77" filter="url(#f1rd7cqprzqpr1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1102,1197.3984 L1102,1207.3984 L1112,1207.3984 L1102,1197.3984 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="281" x="816" y="1214.4653">ActivityService returns the ActivitySummary</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="816" y="1229.5981">object to ActivityWorker. This is to allow</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="816" y="1244.731">the ActivityWorker in the future to publish</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="816" y="1259.8638">events on the activity lifecycle but these</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="816" y="1274.9966">events have not yet been implemented</text><!--MD5=[b037f695ee541fd9910fb9c8dee3c025]
@startuml


mainframe **Activity API over REST**

autonumber

participant cli as "CLI :\nRestClientUI" #lightgreen
participant FlaskWorker as "REST backend :\nFlaskWorker" #lightblue
participant ActivityWorker
participant ActivityService
participant ODA as "ODA :\nObservation Data Archive" #lightblue
participant ScriptExecutionServiceWorker as "SESWorker :\nScriptExecutionServiceWorker"
participant ScriptExecutionService as "Script Execution API :\nScriptExecutionService"

cli -> FlaskWorker: HTTP POST to /api/v1/activities
note right
The User executes an OET CLI command at
the terminal. The OET CLI uses HTTP POST
to send a JSON object encapsulating the
request (activity name, scheduling block ID,
etc.) to the REST backend.
end note

FlaskWorker -> ActivityWorker: send message request.activity.run
note right
""FlaskWorker"" creates a ""ActivityCommand""
encapsulating the request details and announces
the event on the //Run Activity requested// request
topic. It will then wait for a response on the //Activity//
//running// response topic.
end note

ActivityWorker -> ActivityService: run(cmd: ActivityCommand)

ActivityService -> ODA: oda.sbds.get(sbd_id)
note right
Retrieve the Scheduling Block Definition from ODA.
The ODA client will return a SBDefinition PDM object.
end note
ODA -> ActivityService: pdm.SBDefinition

opt script_args provided
ActivityService -> ActivityService: update SB args
end
note right
If user has provided additional arguments for the script,
the retrieved SB is updated to include any additional
arguments and overwrite any existing keyword arguments
end note

ActivityService -> ActivityService: write SB to file
note right
ActivityService will write SB JSON to file with a unique
name consisting of SB ID, SB version and timestamp. SBs
are stored in folder /tmp/sbs/ and path to the SB is passed
as an argument in the PrepareProcessCommand
end note


ActivityService -> ScriptExecutionServiceWorker: message request.procedure.prepare

note right
ActivityService creates a PrepareProcessCommand and
announces it on the Create Procedure topic. It then
waits for the response topic Procedure Created and
creates an ActivitySummary based on  the response that
is passed on to the REST backend and client.
end note

ScriptExecutionServiceWorker -> ScriptExecutionService: prepare(cmd: PrepareProcessCommand)

ScriptExecutionService -> ScriptExecutionServiceWorker: ProcedureSummary

ScriptExecutionServiceWorker -> ActivityService: message procedure.lifecycle.preparing

ActivityService -> ActivityWorker: ActivitySummary

ActivityWorker -> FlaskWorker: message activity.lifecycle.running

cli <- FlaskWorker: HTTP OK + ActivitySummary JSON
note right
The FlaskWorker will block the client side until it
receives a message on activity.lifecycle.running
topic from the ActivityWorker indicating that the
preparation on the activity has been started.
Afterwards the user can stay updated on the activity
status by querying the procedure CLI with the script
ID given by the ActivitySummary or by listening to
the lifecycle events.
end note

opt prepare_only not set
ActivityService -> ScriptExecutionServiceWorker: message request.procedure.start (force=true)
note right
By default the ScriptExecutionServiceWorker
does not allow a StartProcessCommand to be
queued if the process is not yet ready to start.
Instead of the ActivityService waiting for the
process to be ready, set a flag to tell the
SESWorker to ignore the current process state
and queue the start command anyway.
end note

ScriptExecutionServiceWorker -> ScriptExecutionService: start(cmd: StartProcessCommand)

ScriptExecutionService -> ScriptExecutionServiceWorker: ProcedureSummary

ScriptExecutionServiceWorker -> ActivityService: message procedure.lifecycle.started

ActivityService -> ActivityWorker: ActivitySummary
note right
ActivityService returns the ActivitySummary
object to ActivityWorker. This is to allow
the ActivityWorker in the future to publish
events on the activity lifecycle but these
events have not yet been implemented
end note

end
note right
If prepare_only flag is not set, the
ActivityService creates and announces
a StartProcessCommand and waits for a
response on  procedure.lifecycle.started
topic. Once it gets the response, it
creates an ActivitySummary object that
is returned to the ActivityWorker.
end note

@enduml

PlantUML version 1.2020.06(Sun Apr 05 12:38:32 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+33
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>