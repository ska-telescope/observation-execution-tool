<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1460px" preserveAspectRatio="none" style="width:2073px;height:1460px;background:#FFFFFF;" version="1.1" viewBox="0 0 2073 1460" width="2073px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1439.0156" style="stroke:#181818;stroke-width:1.5;" width="2062.5" x="5" y="15"/><path d="M188,15 L188,24.2969 L178,34.2969 L5,34.2969 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="173" x="8" y="28.9951">Activity API over REST</text><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="230" x="989.5" y="489.4141"/><rect fill="none" height="143.0625" style="stroke:#000000;stroke-width:1.5;" width="788" x="989.5" y="1032.7344"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="64" x2="64" y1="90.8906" y2="1392.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="328" x2="328" y1="90.8906" y2="1392.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="588" x2="588" y1="90.8906" y2="1392.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1054.5" x2="1054.5" y1="90.8906" y2="1392.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1225.5" x2="1225.5" y1="90.8906" y2="1392.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1439.5" x2="1439.5" y1="90.8906" y2="1392.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1748" x2="1748" y1="90.8906" y2="1392.125"/><rect fill="#90EE90" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="15" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="49.5" y="63.292">CLI :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="22" y="79.5889">RestClientUI</text><rect fill="#90EE90" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="15" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="49.5" y="1411.1201">CLI :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="22" y="1427.417">RestClientUI</text><rect fill="#ADD8E6" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="266" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="273" y="63.292">REST backend :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="278.5" y="79.5889">FastAPIWorker</text><rect fill="#ADD8E6" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124" x="266" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110" x="273" y="1411.1201">REST backend :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="278.5" y="1427.417">FastAPIWorker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="533" y="59.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="540" y="79.5889">ActivityWorker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="533" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="540" y="1411.1201">ActivityWorker</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111" x="999.5" y="59.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="1006.5" y="79.5889">ActivityService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="111" x="999.5" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="1006.5" y="1411.1201">ActivityService</text><rect fill="#ADD8E6" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187" x="1132.5" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1206" y="63.292">ODA :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173" x="1139.5" y="79.5889">Observation Data Archive</text><rect fill="#ADD8E6" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187" x="1132.5" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="1206" y="1411.1201">ODA :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173" x="1139.5" y="1427.417">Observation Data Archive</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="220" x="1329.5" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="1397" y="63.292">SESWorker :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="206" x="1336.5" y="79.5889">ScriptExecutionServiceWorker</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="220" x="1329.5" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="1397" y="1411.1201">SESWorker :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="206" x="1336.5" y="1427.417">ScriptExecutionServiceWorker</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="171" x="1663" y="43.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="1676" y="63.292">Script Execution API :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="1670" y="79.5889">ScriptExecutionService</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="171" x="1663" y="1391.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="145" x="1676" y="1411.1201">Script Execution API :</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="1670" y="1427.417">ScriptExecutionService</text><polygon fill="#181818" points="316,151.2891,326,155.2891,316,159.2891,320,155.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="64" x2="322" y1="155.2891" y2="155.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="71" y="150.2231">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="84" y="150.2231">HTTP POST to /api/v1/activities</text><path d="M333,105.8906 L333,190.8906 L632,190.8906 L632,115.8906 L622,105.8906 L333,105.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M622,105.8906 L622,115.8906 L632,115.8906 L622,105.8906 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="339" y="122.9575">The User executes an OET CLI command at</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="339" y="138.0903">the terminal. The OET CLI uses HTTP POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="339" y="153.2231">to send a JSON object encapsulating the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="339" y="168.356">request (activity name, scheduling block ID,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="339" y="183.4888">etc.) to the REST backend.</text><polygon fill="#181818" points="576,246.9531,586,250.9531,576,254.9531,580,250.9531" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="328" x2="582" y1="250.9531" y2="250.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="335" y="245.8872">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="348" y="245.8872">send message request.activity.run</text><path d="M593,201.5547 L593,286.5547 L938,286.5547 L938,211.5547 L928,201.5547 L593,201.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M928,201.5547 L928,211.5547 L938,211.5547 L928,201.5547 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="104" x="599" y="218.6216">FastAPIWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="707" y="218.6216">creates a</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="120" x="771" y="218.6216">ActivityCommand</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315" x="599" y="233.7544">encapsulating the request details and announces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="599" y="248.8872">the event on the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="146" x="709" y="248.8872">Run Activity requested</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="859" y="248.8872">request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="599" y="264.02">topic. It will then wait for a response on the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="875" y="264.02">Activity</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="599" y="279.1528">running</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="651" y="279.1528">response topic.</text><polygon fill="#181818" points="1043,350.1836,1053,354.1836,1043,358.1836,1047,354.1836" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="588" x2="1049" y1="354.1836" y2="354.1836"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="595" y="349.1177">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="388" x="608" y="349.1177">prepare_run_activity(cmd: ActivityCommand, request_id: int)</text><path d="M1060,297.2188 L1060,397.2188 L1399,397.2188 L1399,307.2188 L1389,297.2188 L1060,297.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1389,297.2188 L1389,307.2188 L1399,307.2188 L1389,297.2188 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="1066" y="314.2856">Pass the request_id to ActivityService where it</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="1066" y="329.4185">keeps a record of request IDs mapped to activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="1066" y="344.5513">IDs. This is so that the service can use the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="1066" y="359.6841">request ID in messages sent to the procedure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="1066" y="374.8169">domain and any events published from procedure</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="1066" y="389.9497">domain are linked to the correct activity.</text><polygon fill="#181818" points="1214,430.7148,1224,434.7148,1214,438.7148,1218,434.7148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1055" x2="1220" y1="434.7148" y2="434.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1062" y="429.6489">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="1075" y="429.6489">oda.sbds.get(sbd_id)</text><path d="M1231,408.0156 L1231,448.0156 L1585,448.0156 L1585,418.0156 L1575,408.0156 L1231,408.0156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1575,408.0156 L1575,418.0156 L1585,418.0156 L1575,408.0156 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="1237" y="425.0825">Retrieve the Scheduling Block Definition from ODA.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="1237" y="440.2153">The ODA client will return a SBDefinition PDM object.</text><polygon fill="#181818" points="1066,470.4141,1056,474.4141,1066,478.4141,1062,474.4141" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1060" x2="1225" y1="474.4141" y2="474.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1072" y="469.3481">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="1085" y="469.3481">pdm.SBDefinition</text><path d="M989.5,489.4141 L1059.5,489.4141 L1059.5,496.5469 L1049.5,506.5469 L989.5,506.5469 L989.5,489.4141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="59.2656" style="stroke:#000000;stroke-width:1.5;" width="230" x="989.5" y="489.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="1004.5" y="502.481">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="140" x="1074.5" y="501.6245">[script_args provided]</text><path d="M1224.5,494.4141 L1224.5,549.4141 L1615.5,549.4141 L1615.5,504.4141 L1605.5,494.4141 L1224.5,494.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1605.5,494.4141 L1605.5,504.4141 L1615.5,504.4141 L1605.5,494.4141 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="1230.5" y="511.481">If user has provided additional arguments for the script,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1230.5" y="526.6138">the retrieved SB is updated to include any additional</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="1230.5" y="541.7466">arguments and overwrite any existing keyword arguments</text><line style="stroke:#181818;stroke-width:1.0;" x1="1055" x2="1097" y1="527.6797" y2="527.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="1097" x2="1097" y1="527.6797" y2="540.6797"/><line style="stroke:#181818;stroke-width:1.0;" x1="1056" x2="1097" y1="540.6797" y2="540.6797"/><polygon fill="#181818" points="1066,536.6797,1056,540.6797,1066,544.6797,1062,540.6797" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1062" y="522.6138">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="1075" y="522.6138">update SB args</text><line style="stroke:#181818;stroke-width:1.0;" x1="1055" x2="1097" y1="596.0117" y2="596.0117"/><line style="stroke:#181818;stroke-width:1.0;" x1="1097" x2="1097" y1="596.0117" y2="609.0117"/><line style="stroke:#181818;stroke-width:1.0;" x1="1056" x2="1097" y1="609.0117" y2="609.0117"/><polygon fill="#181818" points="1066,605.0117,1056,609.0117,1066,613.0117,1062,609.0117" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1062" y="590.9458">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="1075" y="590.9458">write SB to file</text><path d="M1178,560.6797 L1178,630.6797 L1573,630.6797 L1573,570.6797 L1563,560.6797 L1178,560.6797 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1563,560.6797 L1563,570.6797 L1573,570.6797 L1563,560.6797 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1184" y="577.7466">ActivityService will write SB JSON to file with a unique</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="1184" y="592.8794">name consisting of SB ID, SB version and timestamp. SBs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="374" x="1184" y="608.0122">are stored in folder /tmp/sbs/ and path to the SB is passed</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="1184" y="623.145">as an argument in the PrepareProcessCommand</text><line style="stroke:#181818;stroke-width:1.0;" x1="1055" x2="1097" y1="668.9766" y2="668.9766"/><line style="stroke:#181818;stroke-width:1.0;" x1="1097" x2="1097" y1="668.9766" y2="681.9766"/><line style="stroke:#181818;stroke-width:1.0;" x1="1056" x2="1097" y1="681.9766" y2="681.9766"/><polygon fill="#181818" points="1066,677.9766,1056,681.9766,1066,685.9766,1062,681.9766" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1062" y="663.9106">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="1075" y="663.9106">add SB path to kwargs</text><path d="M1231,641.2109 L1231,696.2109 L1586,696.2109 L1586,651.2109 L1576,641.2109 L1231,641.2109 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1576,641.2109 L1576,651.2109 L1586,651.2109 L1576,641.2109 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1237" y="658.2778">The SB JSON filepath string is appended to the list of</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="1237" y="673.4106">script keyword arguments for</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="32" x="1427" y="673.4106">main</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="1463" y="673.4106">function under</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47" x="1237" y="688.5435">the key</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="48" x="1288" y="688.5435">sb_json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1336" y="688.5435">.</text><polygon fill="#181818" points="1427.5,752.0078,1437.5,756.0078,1427.5,760.0078,1431.5,756.0078" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1055" x2="1433.5" y1="756.0078" y2="756.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1062" y="750.9419">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="1075" y="750.9419">message request.procedure.prepare</text><path d="M1444,706.6094 L1444,791.6094 L1831,791.6094 L1831,716.6094 L1821,706.6094 L1444,706.6094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1821,706.6094 L1821,716.6094 L1831,716.6094 L1821,706.6094 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="356" x="1450" y="723.6763">ActivityService creates a PrepareProcessCommand and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="327" x="1450" y="738.8091">announces it on the Create Procedure topic. It then</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="1450" y="753.9419">waits for the response topic Procedure Created and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="366" x="1450" y="769.0747">creates an ActivitySummary based on  the response that</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="286" x="1450" y="784.2075">is passed on to the REST backend and client.</text><polygon fill="#181818" points="1736.5,814.4063,1746.5,818.4063,1736.5,822.4063,1740.5,818.4063" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1439.5" x2="1742.5" y1="818.4063" y2="818.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1446.5" y="813.3403">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263" x="1468.5" y="813.3403">prepare(cmd: PrepareProcessCommand)</text><polygon fill="#181818" points="1450.5,843.5391,1440.5,847.5391,1450.5,851.5391,1446.5,847.5391" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1444.5" x2="1747.5" y1="847.5391" y2="847.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1456.5" y="842.4731">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1478.5" y="842.4731">ProcedureSummary</text><polygon fill="#181818" points="599,872.6719,589,876.6719,599,880.6719,595,876.6719" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="593" x2="1438.5" y1="876.6719" y2="876.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="605" y="871.606">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="627" y="871.606">message procedure.lifecycle.created</text><polygon fill="#181818" points="1043,957.7695,1053,961.7695,1043,965.7695,1047,961.7695" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="588" x2="1049" y1="961.7695" y2="961.7695"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="595" y="956.7036">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="421" x="617" y="956.7036">complete_run_activity(result: ProcedureSummary, request_id: int)</text><path d="M1060,889.6719 L1060,1020.6719 L1495,1020.6719 L1495,899.6719 L1485,889.6719 L1060,889.6719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1485,889.6719 L1485,899.6719 L1495,899.6719 L1485,889.6719 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="361" x="1066" y="906.7388">ActivityService inspects each procedure.lifecycle.created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="378" x="1066" y="921.8716">message and checks if the request ID maps to any activity.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="350" x="1066" y="937.0044">This check is done to make sure that the message has</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="377" x="1066" y="952.1372">originated from a procedure created by the activity domain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="335" x="1066" y="967.27">rather than independently by the procedure domain.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="382" x="1066" y="982.4028">If the request ID does not map to an activity, ActivityService</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="1066" y="997.5356">will return a null response to ActivityWorker which will know</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414" x="1066" y="1012.6685">to keep waiting for another procedure.lifecycle.created message.</text><path d="M989.5,1032.7344 L1059.5,1032.7344 L1059.5,1039.8672 L1049.5,1049.8672 L989.5,1049.8672 L989.5,1032.7344 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="143.0625" style="stroke:#000000;stroke-width:1.5;" width="788" x="989.5" y="1032.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="1004.5" y="1045.8013">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="142" x="1074.5" y="1044.9448">[prepare_only not set]</text><path d="M1782.5,1037.7344 L1782.5,1152.7344 L2050.5,1152.7344 L2050.5,1047.7344 L2040.5,1037.7344 L1782.5,1037.7344 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M2040.5,1037.7344 L2040.5,1047.7344 L2050.5,1047.7344 L2040.5,1037.7344 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35" x="1788.5" y="1054.8013">Note</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="7" x="1788.5" y="1069.9341">If</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="96" x="1799.5" y="1069.9341">prepare_only</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1899.5" y="1069.9341">flag is not set, the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="1788.5" y="1085.0669">ActivityService creates and announces</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1788.5" y="1100.1997">a StartProcessCommand but currently</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="1788.5" y="1115.3325">does not wait for response to further</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="1788.5" y="1130.4653">follow the lifecycle of the created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="1788.5" y="1145.5981">procedure</text><polygon fill="#181818" points="1427.5,1115.3984,1437.5,1119.3984,1427.5,1123.3984,1431.5,1119.3984" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1055" x2="1433.5" y1="1119.3984" y2="1119.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1062" y="1114.3325">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="1084" y="1114.3325">message request.procedure.start (force=true)</text><path d="M1444,1054.8672 L1444,1169.8672 L1762,1169.8672 L1762,1064.8672 L1752,1054.8672 L1444,1054.8672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M1752,1054.8672 L1752,1064.8672 L1762,1064.8672 L1752,1054.8672 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="1450" y="1071.9341">By default the ScriptExecutionServiceWorker</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293" x="1450" y="1087.0669">does not allow a StartProcessCommand to be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="1450" y="1102.1997">queued if the process is not yet ready to start.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="1450" y="1117.3325">Instead of the ActivityService waiting for the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="1450" y="1132.4653">process to be ready, set a flag to tell the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="297" x="1450" y="1147.5981">SESWorker to ignore the current process state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="1450" y="1162.731">and queue the start command anyway.</text><polygon fill="#181818" points="599,1199.9297,589,1203.9297,599,1207.9297,595,1203.9297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="593" x2="1054" y1="1203.9297" y2="1203.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="605" y="1198.8638">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="627" y="1198.8638">ActivitySummary</text><polygon fill="#181818" points="339,1229.0625,329,1233.0625,339,1237.0625,335,1233.0625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="333" x2="587" y1="1233.0625" y2="1233.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="345" y="1227.9966">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="367" y="1227.9966">message activity.lifecycle.running</text><polygon fill="#181818" points="75,1314.1602,65,1318.1602,75,1322.1602,71,1318.1602" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="69" x2="327" y1="1318.1602" y2="1318.1602"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="81" y="1313.0942">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="103" y="1313.0942">HTTP OK + ActivitySummary JSON</text><path d="M333,1246.0625 L333,1377.0625 L688,1377.0625 L688,1256.0625 L678,1246.0625 L333,1246.0625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M678,1246.0625 L678,1256.0625 L688,1256.0625 L678,1246.0625 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="313" x="339" y="1263.1294">The FastAPIWorker will block the client side until it</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="303" x="339" y="1278.2622">receives a message on activity.lifecycle.running</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="339" y="1293.395">topic from the ActivityWorker indicating that the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="339" y="1308.5278">preparation on the activity has been started.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="339" y="1323.6606">Afterwards the user can stay updated on the activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="328" x="339" y="1338.7935">status by querying the procedure CLI with the script</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="339" y="1353.9263">ID given by the ActivitySummary or by listening to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="339" y="1369.0591">the lifecycle events.</text><!--SRC=[hLZRRXit47tdLn3gGnFLqQAlHbl0YLFKlTc87FIbW47jpagCLjmjoRMYl-yPShaNILPIe400Mn7dTkRCpTzkl6_STPOrbJA-tLMBlDvbZlvfoUJqfj1gRTLE2B5JsfJubUHyVfDx_QpzGTuytCdwcQpyy7xvE9yBeLfVctQt8Yj4ewpNkMwWL-QLbih9sRlVx-Jrt-O3EV-kqcJynxkP_ARIwurVMo8p4VfPEGyBVzLs2nCipcRaIkLRCWNhcRn8YbPLInCzoTtuxEnNIxBFEf-AtT_U1AFy4xRkLmwFbDUraRVAAtbZyur-fXVDBdEh6__-C-Kj2tKcHj4ito-xJr1_wVNiA_H6ZU4hsNyN4lIYyfaGd9StFqsHlfQ_F3u-o8TxOErhcQb6Py_VPof2fSa9KtkIbeCMZnkI7m6CfA2Sd5H6thz_b9nfK6cda2dbXSSxJtQdZQeMagNIezP1gBSeOD5nTfNyTNd_fwnNdoZt4cHKZMihm6_M4ig4POewBr-fH4O3Sbv9bs-eQ2j-jghgV2llRgy4-NpnceDXDyOaMWYsnV48CQKRK9dovZhwjIFdr1hXH_kBP7vXMpC6PZQRadCcSqig02HdiwJwNKHeDXCd4IOBiY2lTCN00XLZwXQ5wGAWz8mAaaWpVyYo3wtfVKxIL6HP-XtODZfVo3ilzxggMCh8lT9UbZKOYMUkgOsZGMFIbcKYon2WWMz1N_SmAXnXE8Li36B7kMlPM0ARwGdgdX9uh_9TSIsFGBbAVZzfVAcDVpt6zq4vDuO9ZpZ1H-RaVaEMfFPYIzIu46HUsqBMPO_ltQsJEzKq51GabmJ-cucgdSG_nzHHFXXqdUeSJ6yPX14RxsxXQEA8OyRuHBl6rZcOQKaKDJVJBf-7c4KdctPLQGVoojBMkpFF4GTelOrkiaO4OhauUWgUIKJ20Pb07xkMTQ4MRbMunPhyA_m2s2QmVY1lDJmA1fP3BRqDjNHBfJOwT9RW95GkGWlW7fc7XXwfPSct5ZxBvTkHpCFj7rr1ZrnbqRCyANQBiRGGDLgR2vtiITcrOuYUTK75kM1FrBLDWUg3Fv9bsVmuxBkIKsdbHWrgfIgAO5bLBDFkGfguL08BWYDN8b8mWbQmUh0bsWfvqYQlse92eWTzOj37BE0HkhVQnsVqMRlG1BPqs3DN-yUNytiISbG9b-17gIiQ1tnI9vorNY2qtauAN_aDCjaQ3OuBxh9Wdd6TaoWa2A39yW_4uJZH79JNA0ElTiq2tpZ1z7M-je05P2xhgW3ScTyrcLkvB4Wq2eOwRaSW6nGvygl2L4ami3m_UOYDv84BnRckQVn7Y90IDfKiR_U174VpBG72Q8IN3kb6w72GsuOfXf941QCXboAoupI3WJvPnWMDFbgYbOV2QA731Yf10j-xrTCdL-F9kAJF1NHfQxW-cLLzJrbqJLXSeiGmhyuYpIaJ_Jn2YqrZursGam_9c1p63aySmHDdgAFfB1b9HJNHJE_ACE2MBRom1mnoC8HD7sb3jnOzWu9hfzC_i2wshJ7G5nUt5q7l9riSPcSnU_sIyY_diWUc2_pBRXwlBuaD0migNL9-o2jQH82BhnhWsEgQYlpH10VoRULF_JmpnI-HJXlNO3uuIIhVN7GrXHDokA5y2mwMayK9mnXptOMfpkst7vDXgWSPhk6YDim-lDsYHGN2fb6VR60iY1eEOtlrQK2hmRkkL0gvEWInVYMDerjOD0rYkeE_6gKUUeRnrI4939gYn887qb4eHOq2078SKmofjtDrSiTCXx1fmwU-q8weWIL90-mWipNrddTmNfV2RiYDBgo7CCr1N4X9WcjSIpopqyPN6qJC4JZo_sSpmvInE0JWPKu_UjlIPADvYpHGgK3ERgTvsOZeCLPLLUzvVM7LHtqFwAn8m8cMPrav9D25LP753-JXfoeE_3YuXumQRECgR9uiSJA0HrZpHfaq1cjHsHK31wVAIgr3EwEun8lXaEIDOsrg6_UtlCM2Q7pl7Jn1JZY6u7tSOm9u_QLc3dirMIIFDwNv_4zymAqFXixduzJEvz6p3WFuUXMyUt6kJEwPyrYlMf-Yg0v3UlgZPKpgihNCK87TWfCNnt57qOHwQXx3TlrL-qBYuD7mETSkZqxflakbvZDKJNTFnIFyXpTdZ_3xt-Ht9oEFbv7Z7MLwl8PIZkTlY3fkvWvRBLODhoi-Y70wa7uEypqvMPjBViO17NhVcC2TIVGrdQVZDRPF4TaH_sJIBGTzQ-HDUqKuG0C12PVuJUcn1YjRnBikxEDyO-71eL-fZzG8fdJhk8-2qlQGRkUXeVAV6C86EopjEEta6g6Rr7wF0GQny0tlScI2nbfCsHHFjb6P_0i0]--></g></svg>