<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1038px" preserveAspectRatio="none" style="width:1707px;height:1038px;" version="1.1" viewBox="0 0 1707 1038" width="1707px" zoomAndPan="magnify"><defs><filter height="300%" id="frvdv2hg72rct" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#frvdv2hg72rct)" height="62.4297" style="stroke: #000000; stroke-width: 2.0;" width="357.5" x="1049.5" y="185.8281"/><rect fill="#FFFFFF" filter="url(#frvdv2hg72rct)" height="91.5625" style="stroke: #000000; stroke-width: 2.0;" width="563" x="1049.5" y="316.5234"/><rect fill="#FFFFFF" filter="url(#frvdv2hg72rct)" height="314.3281" style="stroke: #000000; stroke-width: 2.0;" width="1673.5" x="12" y="465.2188"/><rect fill="#FFFFFF" height="128.5313" style="stroke: none; stroke-width: 1.0;" width="1673.5" x="12" y="651.0156"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="59" x2="59" y1="38.2969" y2="998.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="427" x2="427" y1="38.2969" y2="998.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="795" x2="795" y1="38.2969" y2="998.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1141.5" x2="1141.5" y1="38.2969" y2="998.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1359" x2="1359" y1="235.6094" y2="998.3438"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1551.5" x2="1551.5" y1="366.3047" y2="998.3438"/><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="31" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="38" y="22.9951">Client</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="31" y="997.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="38" y="1017.3389">Client</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="366" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="373" y="22.9951">TangoExecutor</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="366" y="997.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="373" y="1017.3389">TangoExecutor</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="259" x="664" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="245" x="671" y="22.9951">SingleQueueEventHandlingStrategy</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="259" x="664" y="997.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="245" x="671" y="1017.3389">SingleQueueEventHandlingStrategy</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1059.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1066.5" y="22.9951">SubscriptionManager</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="1059.5" y="997.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="1066.5" y="1017.3389">SubscriptionManager</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="1322" y="997.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="1329" y="1017.3389">Callback</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="1500.5" y="997.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="1507.5" y="1017.3389">DeviceProxy</text><rect fill="#EEEEEE" filter="url(#frvdv2hg72rct)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1692.5" x="3" y="68.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1695.5" y1="68.8633" y2="68.8633"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1695.5" y1="71.8633" y2="71.8633"/><rect fill="#EEEEEE" filter="url(#frvdv2hg72rct)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="151" x="773.75" y="58.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="779.75" y="74.3638">event subscription</text><polygon fill="#A80036" points="415.5,108.5625,425.5,112.5625,415.5,116.5625,419.5,112.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="421.5" y1="112.5625" y2="112.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="66.5" y="107.4966">subscribe_event(attr: Attribute)</text><polygon fill="#A80036" points="783.5,137.6953,793.5,141.6953,783.5,145.6953,787.5,141.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="789.5" y1="141.6953" y2="141.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="434.5" y="136.6294">subscribe_event(attr: Attribute)</text><polygon fill="#A80036" points="1129.5,166.8281,1139.5,170.8281,1129.5,174.8281,1133.5,170.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="795.5" x2="1135.5" y1="170.8281" y2="170.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="802.5" y="165.7622">register_observer(attr: Attribute, observer = self)</text><path d="M1049.5,185.8281 L1113.5,185.8281 L1113.5,192.8281 L1103.5,202.8281 L1049.5,202.8281 L1049.5,185.8281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="62.4297" style="stroke: #000000; stroke-width: 2.0;" width="357.5" x="1049.5" y="185.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1064.5" y="198.895">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="1128.5" y="198.0386">[is first subscription to attribute]</text><polygon fill="#A80036" points="1310,220.0938,1320,224.0938,1310,228.0938,1314,224.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1141.5" x2="1316" y1="224.0938" y2="224.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="57" x="1148.5" y="219.0278">__init__()</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="1322" y="202.9609"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="1329" y="222.9561">Callback</text><polygon fill="#A80036" points="1347.5,284.957,1357.5,288.957,1347.5,292.957,1351.5,288.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1141.5" x2="1353.5" y1="288.957" y2="288.957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="1148.5" y="283.8911">register_observer(observer)</text><path d="M802,260.2578 L802,300.2578 L1132,300.2578 L1132,270.2578 L1122,260.2578 L802,260.2578 " fill="#FBFB77" filter="url(#frvdv2hg72rct)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1122,260.2578 L1122,270.2578 L1132,270.2578 L1122,260.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="309" x="808" y="277.3247">Observer registration occurs before Tango event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="808" y="292.4575">subscription to ensure the first event is not lost.</text><path d="M1049.5,316.5234 L1113.5,316.5234 L1113.5,323.5234 L1103.5,333.5234 L1049.5,333.5234 L1049.5,316.5234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="91.5625" style="stroke: #000000; stroke-width: 2.0;" width="563" x="1049.5" y="316.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1064.5" y="329.5903">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="211" x="1128.5" y="328.7339">[is first subscription to attribute]</text><polygon fill="#A80036" points="1488.5,350.7891,1498.5,354.7891,1488.5,358.7891,1492.5,354.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1141.5" x2="1494.5" y1="354.7891" y2="354.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="1148.5" y="349.7231">__init__(device: str = attr.device, attr: str = attr.attr)</text><rect fill="#FEFECE" filter="url(#frvdv2hg72rct)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="98" x="1500.5" y="333.6563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="84" x="1507.5" y="353.6514">DeviceProxy</text><polygon fill="#A80036" points="1539.5,396.0859,1549.5,400.0859,1539.5,404.0859,1543.5,400.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1141.5" x2="1545.5" y1="400.0859" y2="400.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1148.5" y="395.02">subscribe_event(attr: Attribute, cb=Callback)</text><rect fill="#EEEEEE" filter="url(#frvdv2hg72rct)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1692.5" x="3" y="435.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1695.5" y1="435.6523" y2="435.6523"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1695.5" y1="438.6523" y2="438.6523"/><rect fill="#EEEEEE" filter="url(#frvdv2hg72rct)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="130" x="784.25" y="425.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="116" x="790.25" y="441.1528">event reception</text><path d="M12,465.2188 L82,465.2188 L82,472.2188 L72,482.2188 L12,482.2188 L12,465.2188 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="314.3281" style="stroke: #000000; stroke-width: 2.0;" width="1673.5" x="12" y="465.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="27" y="478.2856">par</text><path d="M22,487.3516 L22,512.3516 L1588,512.3516 L1588,497.3516 L1578,487.3516 L22,487.3516 " fill="#FBFB77" filter="url(#frvdv2hg72rct)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1578,487.3516 L1578,497.3516 L1588,497.3516 L1578,487.3516 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="821" x="388.25" y="504.4185">The callback is invoked in a separate thread by DeviceProxy, hence this code all runs in parallel with the main thead of execution.</text><polygon fill="#A80036" points="1562.5,521.4844,1552.5,525.4844,1562.5,529.4844,1558.5,525.4844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1556.5" x2="1694.5" y1="525.4844" y2="525.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1568.5" y="538.5513">evt: ChangeEvent</text><polygon fill="#A80036" points="1370.5,550.6172,1360.5,554.6172,1370.5,558.6172,1366.5,554.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1364.5" x2="1550.5" y1="554.6172" y2="554.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1376.5" y="567.6841">evt: ChangeEvent</text><polygon fill="#A80036" points="806.5,579.75,796.5,583.75,806.5,587.75,802.5,583.75" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="800.5" x2="1358.5" y1="583.75" y2="583.75"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="812.5" y="596.8169">notify(evt: EventData)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="795.5" x2="837.5" y1="630.0156" y2="630.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="837.5" x2="837.5" y1="630.0156" y2="643.0156"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="796.5" x2="837.5" y1="643.0156" y2="643.0156"/><polygon fill="#A80036" points="806.5,639.0156,796.5,643.0156,806.5,647.0156,802.5,643.0156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="802.5" y="624.9497">add to event queue</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="12" x2="1685.5" y1="652.0156" y2="652.0156"/><polygon fill="#A80036" points="415.5,670.1484,425.5,674.1484,415.5,678.1484,419.5,674.1484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="421.5" y1="674.1484" y2="674.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="66.5" y="669.0825">read_event(attr: Attribute)</text><polygon fill="#A80036" points="783.5,704.2813,793.5,708.2813,783.5,712.2813,787.5,708.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="789.5" y1="708.2813" y2="708.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="434.5" y="703.2153">read_event(attr: Attribute)</text><path d="M800,687.1484 L800,712.1484 L1347,712.1484 L1347,697.1484 L1337,687.1484 L800,687.1484 " fill="#FBFB77" filter="url(#frvdv2hg72rct)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1337,687.1484 L1337,697.1484 L1347,697.1484 L1337,687.1484 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="526" x="806" y="704.2153">This blocks until the callback activity above adds an event to the strategy's Queue.</text><polygon fill="#A80036" points="438.5,721.2813,428.5,725.2813,438.5,729.2813,434.5,725.2813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432.5" x2="794.5" y1="725.2813" y2="725.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="444.5" y="738.3481">evt: EventData</text><polygon fill="#A80036" points="70.5,750.4141,60.5,754.4141,70.5,758.4141,66.5,754.4141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="64.5" x2="426.5" y1="754.4141" y2="754.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="76.5" y="767.481">evt: EventData</text><rect fill="#EEEEEE" filter="url(#frvdv2hg72rct)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1692.5" x="3" y="807.1133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1695.5" y1="807.1133" y2="807.1133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1695.5" y1="810.1133" y2="810.1133"/><rect fill="#EEEEEE" filter="url(#frvdv2hg72rct)" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="150" x="774.25" y="796.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="780.25" y="812.6138">event unsubscribe</text><polygon fill="#A80036" points="415.5,846.8125,425.5,850.8125,415.5,854.8125,419.5,850.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59.5" x2="421.5" y1="850.8125" y2="850.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="66.5" y="845.7466">unsubscribe_event(attr: Attribute, subscription_id: int)</text><polygon fill="#A80036" points="783.5,875.9453,793.5,879.9453,783.5,883.9453,787.5,879.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="789.5" y1="879.9453" y2="879.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="344" x="434.5" y="874.8794">unsubscribe_event(attr: Attribute, subscription_id: int)</text><polygon fill="#A80036" points="1129.5,905.0781,1139.5,909.0781,1129.5,913.0781,1133.5,909.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="795.5" x2="1135.5" y1="909.0781" y2="909.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="802.5" y="904.0122">unregister_observer(attr: Attribute, observer=self)</text><polygon fill="#A80036" points="1347.5,934.2109,1357.5,938.2109,1347.5,942.2109,1351.5,938.2109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1141.5" x2="1353.5" y1="938.2109" y2="938.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="1148.5" y="933.145">unregister_observer(observer)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="795.5" x2="837.5" y1="967.3438" y2="967.3438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="837.5" x2="837.5" y1="967.3438" y2="980.3438"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="796.5" x2="837.5" y1="980.3438" y2="980.3438"/><polygon fill="#A80036" points="806.5,976.3438,796.5,980.3438,806.5,984.3438,802.5,980.3438" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="802.5" y="962.2778">drain any remaining events</text><!--MD5=[2f2047ff5b3bfbb0b503efe734e784ce]
@startuml

skinparam responseMessageBelowArrow true
participant Client order 10
participant TangoExecutor order 10
participant SingleQueueEventHandlingStrategy order 10
participant SubscriptionManager order 10
participant Callback order 10
participant DeviceProxy order 10

==event subscription==
Client -> TangoExecutor: subscribe_event(attr: Attribute)
TangoExecutor -> SingleQueueEventHandlingStrategy: subscribe_event(attr: Attribute)
SingleQueueEventHandlingStrategy -> SubscriptionManager: register_observer(attr: Attribute, observer = self)

alt is first subscription to attribute
create Callback
SubscriptionManager -> Callback: ~__init__()
end
SubscriptionManager -> Callback: register_observer(observer)
alt is first subscription to attribute
note left
Observer registration occurs before Tango event
subscription to ensure the first event is not lost.
end note
create DeviceProxy
SubscriptionManager -> DeviceProxy: ~__init__(device: str = attr.device, attr: str = attr.attr)
SubscriptionManager -> DeviceProxy: subscribe_event(attr: Attribute, cb=Callback)
end

==event reception==
par
note across
The callback is invoked in a separate thread by DeviceProxy, hence this code all runs in parallel with the main thead of execution.
end note
DeviceProxy<- -] : evt: ChangeEvent
Callback <- - DeviceProxy: evt: ChangeEvent
SingleQueueEventHandlingStrategy <- Callback: notify(evt: EventData)
SingleQueueEventHandlingStrategy -> SingleQueueEventHandlingStrategy: add to event queue
else
Client -> TangoExecutor: read_event(attr: Attribute)
TangoExecutor -> SingleQueueEventHandlingStrategy: read_event(attr: Attribute)
note right
This blocks until the callback activity above adds an event to the strategy's Queue.
end note
TangoExecutor <- SingleQueueEventHandlingStrategy: evt: EventData
TangoExecutor -> Client: evt: EventData
end

==event unsubscribe==
Client -> TangoExecutor: unsubscribe_event(attr: Attribute, subscription_id: int)
TangoExecutor -> SingleQueueEventHandlingStrategy: unsubscribe_event(attr: Attribute, subscription_id: int)
SingleQueueEventHandlingStrategy -> SubscriptionManager: unregister_observer(attr: Attribute, observer=self)
SubscriptionManager -> Callback: unregister_observer(observer)
SingleQueueEventHandlingStrategy -> SingleQueueEventHandlingStrategy: drain any remaining events

@enduml

PlantUML version 1.2020.06(Sun Apr 05 12:38:32 GMT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 14-ea+33
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
